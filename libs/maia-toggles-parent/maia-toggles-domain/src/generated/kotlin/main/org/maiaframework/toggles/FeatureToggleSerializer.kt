// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.HazelcastSerializerRenderer

package org.maiaframework.toggles

import com.hazelcast.nio.serialization.compact.CompactReader
import com.hazelcast.nio.serialization.compact.CompactSerializer
import com.hazelcast.nio.serialization.compact.CompactWriter
import org.maiaframework.hazelcast.serializers.CompactReaderExtension.readInstantNonNull
import org.maiaframework.hazelcast.serializers.CompactReaderExtension.readInt64NonNull
import org.maiaframework.hazelcast.serializers.CompactReaderExtension.readListOfCompact
import org.maiaframework.hazelcast.serializers.CompactReaderExtension.readListOfStrings
import org.maiaframework.hazelcast.serializers.CompactReaderExtension.readNullableLocalDate
import org.maiaframework.hazelcast.serializers.CompactReaderExtension.readNullableString
import org.maiaframework.hazelcast.serializers.CompactReaderExtension.readStringNonNull
import org.maiaframework.hazelcast.serializers.CompactWriterExtension.writeListOfStrings
import org.maiaframework.hazelcast.serializers.CompactWriterExtension.writeNullableDate
import org.maiaframework.toggles.activation.ActivationStrategyDescriptor
import org.maiaframework.toggles.fields.ContactPerson
import org.maiaframework.toggles.fields.Description
import org.maiaframework.toggles.fields.InfoLink
import org.maiaframework.toggles.fields.TicketKey
import org.springframework.stereotype.Component
import java.time.ZoneOffset


@Component
class FeatureToggleSerializer : CompactSerializer<FeatureToggleEntity> {


    override fun getTypeName(): String {

        return "feature_toggle_entity"

    }


    override fun getCompactClass(): Class<FeatureToggleEntity> {

        return FeatureToggleEntity::class.java

    }


    override fun read(reader: CompactReader): FeatureToggleEntity {

        val activationStrategies = reader.readListOfCompact("activationStrategies", ActivationStrategyDescriptor::class.java)
        val attributesKeys = reader.readListOfStrings("attributesKeys")
        val attributesValues = reader.readListOfStrings("attributesValues")
        val attributes = attributesKeys.zip(attributesValues).toMap()
        val comment = reader.readNullableString("comment")
        val contactPerson = reader.readNullableString("contactPerson")?.let { ContactPerson(it) }
        val createdTimestampUtc = reader.readInstantNonNull("createdTimestampUtc")
        val description = reader.readNullableString("description")?.let { Description(it) }
        val enabled = reader.readBoolean("enabled")
        val featureName = FeatureName(reader.readStringNonNull("featureName"))
        val infoLink = reader.readNullableString("infoLink")?.let { InfoLink(it) }
        val lastModifiedBy = reader.readStringNonNull("lastModifiedBy")
        val lastModifiedTimestampUtc = reader.readInstantNonNull("lastModifiedTimestampUtc")
        val reviewDate = reader.readNullableLocalDate("reviewDate")
        val ticketKey = reader.readNullableString("ticketKey")?.let { TicketKey(it) }
        val version = reader.readInt64NonNull("version")

        return FeatureToggleEntity(
            activationStrategies,
            attributes,
            comment,
            contactPerson,
            createdTimestampUtc,
            description,
            enabled,
            featureName,
            infoLink,
            lastModifiedBy,
            lastModifiedTimestampUtc,
            reviewDate,
            ticketKey,
            version,
        )

    }


    override fun write(writer: CompactWriter, dto: FeatureToggleEntity) {

        writer.apply {

            writeArrayOfCompact("activationStrategies", dto.activationStrategies.toTypedArray())
            val attributesKeys = mutableListOf<String>()
            val attributesValues = mutableListOf<String>()
            dto.attributes.forEach { (key, value) ->
                attributesKeys.add(key)
                attributesValues.add(value)
            }
            writeListOfStrings("attributesKeys", attributesKeys)
            writeListOfStrings("attributesValues", attributesValues)
            writeString("comment", dto.comment)
            writeString("contactPerson", dto.contactPerson?.value)
            writeTimestampWithTimezone("createdTimestampUtc", dto.createdTimestampUtc.atOffset(ZoneOffset.UTC))
            writeString("description", dto.description?.value)
            writeBoolean("enabled", dto.enabled)
            writeString("featureName", dto.featureName.value)
            writeString("infoLink", dto.infoLink?.value)
            writeString("lastModifiedBy", dto.lastModifiedBy)
            writeTimestampWithTimezone("lastModifiedTimestampUtc", dto.lastModifiedTimestampUtc.atOffset(ZoneOffset.UTC))
            writeNullableDate("reviewDate", dto.reviewDate)
            writeString("ticketKey", dto.ticketKey?.value)
            writeInt64("version", dto.version)

        }

    }


}

