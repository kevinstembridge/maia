// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.EntityRowMapperRenderer

package org.maiaframework.toggles

import org.maiaframework.jdbc.MaiaRowMapper
import org.maiaframework.jdbc.ResultSetAdapter
import org.maiaframework.toggles.activation.ActivationStrategyDescriptor
import org.maiaframework.toggles.fields.ContactPerson
import org.maiaframework.toggles.fields.Description
import org.maiaframework.toggles.fields.InfoLink
import org.maiaframework.toggles.fields.TicketKey
import tools.jackson.core.type.TypeReference
import tools.jackson.databind.json.JsonMapper


class FeatureToggleEntityRowMapper(
    private val jsonMapper: JsonMapper
) : MaiaRowMapper<FeatureToggleEntity> {


    override fun mapRow(rsa: ResultSetAdapter): FeatureToggleEntity {

        val activationStrategies = rsa.readString("activation_strategies") { jsonMapper.readValue(it, object : TypeReference<List<ActivationStrategyDescriptor>>() {}) }
        val attributes = rsa.readStringOrNull("attributes") { jsonMapper.readValue(it, object : TypeReference<Map<String, String>?>() {}) }
        val comment = rsa.readStringOrNull("comment")
        val contactPerson = rsa.readStringOrNull("contact_person") { ContactPerson(it) }
        val createdTimestampUtc = rsa.readInstant("created_timestamp_utc")
        val description = rsa.readStringOrNull("description") { Description(it) }
        val enabled = rsa.readBoolean("enabled")
        val featureName = rsa.readString("feature_name") { FeatureName(it) }
        val infoLink = rsa.readStringOrNull("info_link") { InfoLink(it) }
        val lastModifiedByUsername = rsa.readString("last_modified_by_name")
        val lastModifiedTimestampUtc = rsa.readInstant("last_modified_timestamp_utc")
        val reviewDate = rsa.readLocalDateOrNull("review_date")
        val ticketKey = rsa.readStringOrNull("ticket_key") { TicketKey(it) }
        val version = rsa.readLong("version")

        return FeatureToggleEntity(
                activationStrategies,
                attributes,
                comment,
                contactPerson,
                createdTimestampUtc,
                description,
                enabled,
                featureName,
                infoLink,
                lastModifiedByUsername,
                lastModifiedTimestampUtc,
                reviewDate,
                ticketKey,
                version
        )

    }


}

