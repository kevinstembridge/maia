// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.EntityRowMapperRenderer

package org.maiaframework.toggles

import com.fasterxml.jackson.core.type.TypeReference
import com.fasterxml.jackson.databind.ObjectMapper
import org.maiaframework.domain.ChangeType
import org.maiaframework.jdbc.MaiaRowMapper
import org.maiaframework.jdbc.ResultSetAdapter
import org.maiaframework.toggles.activation.ActivationStrategyDescriptor
import org.maiaframework.toggles.fields.ContactPerson
import org.maiaframework.toggles.fields.Description
import org.maiaframework.toggles.fields.InfoLink
import org.maiaframework.toggles.fields.TicketKey


class FeatureToggleHistoryEntityRowMapper(
    private val objectMapper: ObjectMapper
) : MaiaRowMapper<FeatureToggleHistoryEntity> {


    override fun mapRow(rsa: ResultSetAdapter): FeatureToggleHistoryEntity {

        val activationStrategies = rsa.readString("activation_strategies") { objectMapper.readValue(it, object : TypeReference<List<ActivationStrategyDescriptor>>() {}) }
        val attributes = rsa.readStringOrNull("attributes") { objectMapper.readValue(it, object : TypeReference<Map<String, String>?>() {}) }
        val changeType = rsa.readEnum("change_type", ChangeType::class.java)
        val comment = rsa.readStringOrNull("comment")
        val contactPerson = rsa.readStringOrNull("contact_person") { ContactPerson(it) }
        val createdTimestampUtc = rsa.readInstant("created_timestamp_utc")
        val description = rsa.readStringOrNull("description") { Description(it) }
        val enabled = rsa.readBoolean("enabled")
        val featureName = rsa.readString("feature_name") { FeatureName(it) }
        val infoLink = rsa.readStringOrNull("info_link") { InfoLink(it) }
        val lastModifiedByUsername = rsa.readString("last_modified_by_name")
        val lastModifiedTimestampUtc = rsa.readInstant("last_modified_timestamp_utc")
        val reviewDate = rsa.readLocalDateOrNull("review_date")
        val ticketKey = rsa.readStringOrNull("ticket_key") { TicketKey(it) }
        val version = rsa.readLong("version")

        return FeatureToggleHistoryEntity(
                activationStrategies,
                attributes,
                changeType,
                comment,
                contactPerson,
                createdTimestampUtc,
                description,
                enabled,
                featureName,
                infoLink,
                lastModifiedByUsername,
                lastModifiedTimestampUtc,
                reviewDate,
                ticketKey,
                version
        )

    }


}

