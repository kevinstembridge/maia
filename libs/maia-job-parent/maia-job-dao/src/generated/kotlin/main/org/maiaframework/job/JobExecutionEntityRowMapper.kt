// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.EntityRowMapperRenderer

package org.maiaframework.job

import com.fasterxml.jackson.core.type.TypeReference
import tools.jackson.databind.ObjectMapper
import org.maiaframework.jdbc.MaiaRowMapper
import org.maiaframework.jdbc.ResultSetAdapter


class JobExecutionEntityRowMapper(
    private val objectMapper: ObjectMapper
) : MaiaRowMapper<JobExecutionEntity> {


    override fun mapRow(rsa: ResultSetAdapter): JobExecutionEntity {

        val completionStatus = rsa.readEnumOrNull("completion_status", JobCompletionStatus::class.java)
        val createdTimestampUtc = rsa.readInstant("created_timestamp_utc")
        val endTimestampUtc = rsa.readInstantOrNull("end_timestamp_utc")
        val errorMessage = rsa.readStringOrNull("error_message")
        val id = rsa.readDomainId("id")
        val invokedBy = rsa.readString("invoked_by")
        val jobName = rsa.readString("job_name") { JobName(it) }
        val lastModifiedTimestampUtc = rsa.readInstant("last_modified_timestamp_utc")
        val metrics = rsa.readString("metrics") { objectMapper.readValue(it, object : TypeReference<Map<String, Any>>() {}) }
        val stackTrace = rsa.readStringOrNull("stack_trace")
        val startTimestampUtc = rsa.readInstant("start_timestamp_utc")

        return JobExecutionEntity(
                completionStatus,
                createdTimestampUtc,
                endTimestampUtc,
                errorMessage,
                id,
                invokedBy,
                jobName,
                lastModifiedTimestampUtc,
                metrics,
                stackTrace,
                startTimestampUtc
        )

    }


}

