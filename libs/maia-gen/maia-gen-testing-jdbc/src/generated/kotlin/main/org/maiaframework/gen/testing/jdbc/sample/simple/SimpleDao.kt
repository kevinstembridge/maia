// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.JdbcDaoRenderer

package org.maiaframework.gen.testing.jdbc.sample.simple

import com.fasterxml.jackson.databind.ObjectMapper
import org.maiaframework.domain.DomainId
import org.maiaframework.domain.EntityClassAndPk
import org.maiaframework.domain.persist.FieldUpdate
import org.maiaframework.gen.sample.types.SomeStringType
import org.maiaframework.gen.testing.jdbc.sample.types.SomeIntType
import org.maiaframework.gen.testing.jdbc.sample.types.SomeLongType
import org.maiaframework.jdbc.EntityNotFoundException
import org.maiaframework.jdbc.JdbcOps
import org.maiaframework.jdbc.MaiaRowMapper
import org.maiaframework.jdbc.ResultSetAdapter
import org.maiaframework.jdbc.SqlParams
import org.maiaframework.json.JsonFacade
import org.springframework.data.domain.Pageable
import org.springframework.stereotype.Repository
import java.sql.PreparedStatement
import java.time.Instant
import java.time.LocalDate
import java.time.Period


@Repository
class SimpleDao(
    private val fieldConverter: SimpleEntityFieldConverter,
    private val jdbcOps: JdbcOps,
    private val jsonFacade: JsonFacade,
    private val objectMapper: ObjectMapper
) {


    private val entityRowMapper = SimpleEntityRowMapper(objectMapper)


    private val primaryKeyRowMapper = MaiaRowMapper { rsa -> rsa.readDomainId("id") }
    private val fetchForEditDtoRowMapper = SimpleFetchForEditDtoRowMapper(objectMapper)


    fun insert(entity: SimpleEntity) {

        jdbcOps.update(
            """
            insert into testing.simple (
                created_by_id,
                created_by_name,
                c_ts,
                id,
                lm_by_id,
                lm_by_name,
                lm_ts,
                some_boolean,
                some_boolean_nullable,
                some_boolean_type,
                some_boolean_type_nullable,
                some_boolean_type_provided,
                some_boolean_type_provided_nullable,
                some_dto,
                some_dto_nullable,
                some_enum,
                some_enum_nullable,
                some_instant,
                some_instant_modifiable,
                some_instant_modifiable_nullable,
                some_instant_nullable,
                some_int,
                some_int_modifiable,
                some_int_nullable,
                some_int_type,
                some_int_type_nullable,
                some_int_type_provided,
                some_int_type_provided_nullable,
                some_list_of_enums,
                some_list_of_instants,
                some_list_of_local_dates,
                some_list_of_periods,
                some_list_of_string_types,
                some_list_of_strings,
                some_local_date_modifiable,
                some_long_type,
                some_long_type_nullable,
                some_long_type_provided,
                some_long_type_provided_nullable,
                some_map_of_string_to_integer,
                some_map_of_string_type_to_string_type,
                some_period_modifiable,
                some_period_nullable,
                some_provided_string_type,
                some_provided_string_type_nullable,
                some_string,
                some_string_modifiable,
                some_string_nullable,
                some_string_type,
                some_string_type_nullable
            ) values (
                :createdById,
                :createdByUsername,
                :createdTimestampUtc,
                :id,
                :lastModifiedById,
                :lastModifiedByUsername,
                :lastModifiedTimestampUtc,
                :someBoolean,
                :someBooleanNullable,
                :someBooleanType,
                :someBooleanTypeNullable,
                :someBooleanTypeProvided,
                :someBooleanTypeProvidedNullable,
                :someDto,
                :someDtoNullable,
                :someEnum,
                :someEnumNullable,
                :someInstant,
                :someInstantModifiable,
                :someInstantModifiableNullable,
                :someInstantNullable,
                :someInt,
                :someIntModifiable,
                :someIntNullable,
                :someIntType,
                :someIntTypeNullable,
                :someIntTypeProvided,
                :someIntTypeProvidedNullable,
                :someListOfEnums,
                :someListOfInstants,
                :someListOfLocalDates,
                :someListOfPeriods,
                :someListOfStringTypes,
                :someListOfStrings,
                :someLocalDateModifiable,
                :someLongType,
                :someLongTypeNullable,
                :someLongTypeProvided,
                :someLongTypeProvidedNullable,
                :someMapOfStringToInteger,
                :someMapOfStringTypeToStringType,
                :somePeriodModifiable,
                :somePeriodNullable,
                :someProvidedStringType,
                :someProvidedStringTypeNullable,
                :someString,
                :someStringModifiable,
                :someStringNullable,
                :someStringType,
                :someStringTypeNullable
            )
            """.trimIndent(),
            SqlParams().apply {
                addValue("createdById", entity.createdById)
                addValue("createdByUsername", entity.createdByUsername)
                addValue("createdTimestampUtc", entity.createdTimestampUtc)
                addValue("id", entity.id)
                addValue("lastModifiedById", entity.lastModifiedById)
                addValue("lastModifiedByUsername", entity.lastModifiedByUsername)
                addValue("lastModifiedTimestampUtc", entity.lastModifiedTimestampUtc)
                addValue("someBoolean", entity.someBoolean)
                addValue("someBooleanNullable", entity.someBooleanNullable)
                addValue("someBooleanType", entity.someBooleanType)
                addValue("someBooleanTypeNullable", entity.someBooleanTypeNullable)
                addValue("someBooleanTypeProvided", entity.someBooleanTypeProvided)
                addValue("someBooleanTypeProvidedNullable", entity.someBooleanTypeProvidedNullable)
                addJsonValue("someDto", objectMapper.writeValueAsString(entity.someDto))
                addJsonValue("someDtoNullable", entity.someDtoNullable?.let { objectMapper.writeValueAsString(it) })
                addValue("someEnum", entity.someEnum)
                addValue("someEnumNullable", entity.someEnumNullable)
                addValue("someInstant", entity.someInstant)
                addValue("someInstantModifiable", entity.someInstantModifiable)
                addValue("someInstantModifiableNullable", entity.someInstantModifiableNullable)
                addValue("someInstantNullable", entity.someInstantNullable)
                addValue("someInt", entity.someInt)
                addValue("someIntModifiable", entity.someIntModifiable)
                addValue("someIntNullable", entity.someIntNullable)
                addValue("someIntType", entity.someIntType)
                addValue("someIntTypeNullable", entity.someIntTypeNullable)
                addValue("someIntTypeProvided", entity.someIntTypeProvided)
                addValue("someIntTypeProvidedNullable", entity.someIntTypeProvidedNullable)
                addListOfStrings("someListOfEnums", entity.someListOfEnums.map { it.name })
                addListOfInstants("someListOfInstants", entity.someListOfInstants)
                addListOfLocalDates("someListOfLocalDates", entity.someListOfLocalDates)
                addListOfStrings("someListOfPeriods", entity.someListOfPeriods.map { it.toString() })
                addListOfStrings("someListOfStringTypes", entity.someListOfStringTypes.map { it.value })
                addListOfStrings("someListOfStrings", entity.someListOfStrings)
                addValue("someLocalDateModifiable", entity.someLocalDateModifiable)
                addValue("someLongType", entity.someLongType)
                addValue("someLongTypeNullable", entity.someLongTypeNullable)
                addValue("someLongTypeProvided", entity.someLongTypeProvided)
                addValue("someLongTypeProvidedNullable", entity.someLongTypeProvidedNullable)
                addJsonValue("someMapOfStringToInteger", objectMapper.writeValueAsString(entity.someMapOfStringToInteger))
                addJsonValue("someMapOfStringTypeToStringType", objectMapper.writeValueAsString(entity.someMapOfStringTypeToStringType))
                addValue("somePeriodModifiable", entity.somePeriodModifiable)
                addValue("somePeriodNullable", entity.somePeriodNullable)
                addValue("someProvidedStringType", entity.someProvidedStringType)
                addValue("someProvidedStringTypeNullable", entity.someProvidedStringTypeNullable)
                addValue("someString", entity.someString)
                addValue("someStringModifiable", entity.someStringModifiable)
                addValue("someStringNullable", entity.someStringNullable)
                addValue("someStringType", entity.someStringType)
                addValue("someStringTypeNullable", entity.someStringTypeNullable)
            }
        )

    }


    fun bulkInsert(entities: List<SimpleEntity>) {

        jdbcOps.batchUpdate(
            """
            insert into testing.simple (
                created_by_id,
                created_by_name,
                c_ts,
                id,
                lm_by_id,
                lm_by_name,
                lm_ts,
                some_boolean,
                some_boolean_nullable,
                some_boolean_type,
                some_boolean_type_nullable,
                some_boolean_type_provided,
                some_boolean_type_provided_nullable,
                some_dto,
                some_dto_nullable,
                some_enum,
                some_enum_nullable,
                some_instant,
                some_instant_modifiable,
                some_instant_modifiable_nullable,
                some_instant_nullable,
                some_int,
                some_int_modifiable,
                some_int_nullable,
                some_int_type,
                some_int_type_nullable,
                some_int_type_provided,
                some_int_type_provided_nullable,
                some_list_of_enums,
                some_list_of_instants,
                some_list_of_local_dates,
                some_list_of_periods,
                some_list_of_string_types,
                some_list_of_strings,
                some_local_date_modifiable,
                some_long_type,
                some_long_type_nullable,
                some_long_type_provided,
                some_long_type_provided_nullable,
                some_map_of_string_to_integer,
                some_map_of_string_type_to_string_type,
                some_period_modifiable,
                some_period_nullable,
                some_provided_string_type,
                some_provided_string_type_nullable,
                some_string,
                some_string_modifiable,
                some_string_nullable,
                some_string_type,
                some_string_type_nullable
            ) values (
                :createdById,
                :createdByUsername,
                :createdTimestampUtc,
                :id,
                :lastModifiedById,
                :lastModifiedByUsername,
                :lastModifiedTimestampUtc,
                :someBoolean,
                :someBooleanNullable,
                :someBooleanType,
                :someBooleanTypeNullable,
                :someBooleanTypeProvided,
                :someBooleanTypeProvidedNullable,
                :someDto,
                :someDtoNullable,
                :someEnum,
                :someEnumNullable,
                :someInstant,
                :someInstantModifiable,
                :someInstantModifiableNullable,
                :someInstantNullable,
                :someInt,
                :someIntModifiable,
                :someIntNullable,
                :someIntType,
                :someIntTypeNullable,
                :someIntTypeProvided,
                :someIntTypeProvidedNullable,
                :someListOfEnums,
                :someListOfInstants,
                :someListOfLocalDates,
                :someListOfPeriods,
                :someListOfStringTypes,
                :someListOfStrings,
                :someLocalDateModifiable,
                :someLongType,
                :someLongTypeNullable,
                :someLongTypeProvided,
                :someLongTypeProvidedNullable,
                :someMapOfStringToInteger,
                :someMapOfStringTypeToStringType,
                :somePeriodModifiable,
                :somePeriodNullable,
                :someProvidedStringType,
                :someProvidedStringTypeNullable,
                :someString,
                :someStringModifiable,
                :someStringNullable,
                :someStringType,
                :someStringTypeNullable
            )
            """.trimIndent(),
            entities.map { entity ->
                SqlParams().apply {
                    addValue("createdById", entity.createdById)
                    addValue("createdByUsername", entity.createdByUsername)
                    addValue("createdTimestampUtc", entity.createdTimestampUtc)
                    addValue("id", entity.id)
                    addValue("lastModifiedById", entity.lastModifiedById)
                    addValue("lastModifiedByUsername", entity.lastModifiedByUsername)
                    addValue("lastModifiedTimestampUtc", entity.lastModifiedTimestampUtc)
                    addValue("someBoolean", entity.someBoolean)
                    addValue("someBooleanNullable", entity.someBooleanNullable)
                    addValue("someBooleanType", entity.someBooleanType)
                    addValue("someBooleanTypeNullable", entity.someBooleanTypeNullable)
                    addValue("someBooleanTypeProvided", entity.someBooleanTypeProvided)
                    addValue("someBooleanTypeProvidedNullable", entity.someBooleanTypeProvidedNullable)
                    addJsonValue("someDto", objectMapper.writeValueAsString(entity.someDto))
                    addJsonValue("someDtoNullable", entity.someDtoNullable?.let { objectMapper.writeValueAsString(it) })
                    addValue("someEnum", entity.someEnum)
                    addValue("someEnumNullable", entity.someEnumNullable)
                    addValue("someInstant", entity.someInstant)
                    addValue("someInstantModifiable", entity.someInstantModifiable)
                    addValue("someInstantModifiableNullable", entity.someInstantModifiableNullable)
                    addValue("someInstantNullable", entity.someInstantNullable)
                    addValue("someInt", entity.someInt)
                    addValue("someIntModifiable", entity.someIntModifiable)
                    addValue("someIntNullable", entity.someIntNullable)
                    addValue("someIntType", entity.someIntType)
                    addValue("someIntTypeNullable", entity.someIntTypeNullable)
                    addValue("someIntTypeProvided", entity.someIntTypeProvided)
                    addValue("someIntTypeProvidedNullable", entity.someIntTypeProvidedNullable)
                    addListOfStrings("someListOfEnums", entity.someListOfEnums.map { it.name })
                    addListOfInstants("someListOfInstants", entity.someListOfInstants)
                    addListOfLocalDates("someListOfLocalDates", entity.someListOfLocalDates)
                    addListOfStrings("someListOfPeriods", entity.someListOfPeriods.map { it.toString() })
                    addListOfStrings("someListOfStringTypes", entity.someListOfStringTypes.map { it.value })
                    addListOfStrings("someListOfStrings", entity.someListOfStrings)
                    addValue("someLocalDateModifiable", entity.someLocalDateModifiable)
                    addValue("someLongType", entity.someLongType)
                    addValue("someLongTypeNullable", entity.someLongTypeNullable)
                    addValue("someLongTypeProvided", entity.someLongTypeProvided)
                    addValue("someLongTypeProvidedNullable", entity.someLongTypeProvidedNullable)
                    addJsonValue("someMapOfStringToInteger", objectMapper.writeValueAsString(entity.someMapOfStringToInteger))
                    addJsonValue("someMapOfStringTypeToStringType", objectMapper.writeValueAsString(entity.someMapOfStringTypeToStringType))
                    addValue("somePeriodModifiable", entity.somePeriodModifiable)
                    addValue("somePeriodNullable", entity.somePeriodNullable)
                    addValue("someProvidedStringType", entity.someProvidedStringType)
                    addValue("someProvidedStringTypeNullable", entity.someProvidedStringTypeNullable)
                    addValue("someString", entity.someString)
                    addValue("someStringModifiable", entity.someStringModifiable)
                    addValue("someStringNullable", entity.someStringNullable)
                    addValue("someStringType", entity.someStringType)
                    addValue("someStringTypeNullable", entity.someStringTypeNullable)
                }
            }
        )

    }


    fun count(): Long {

        return jdbcOps.queryForLong(
            "select count(*) from testing.simple",
            SqlParams()
        )

    }


    fun count(filter: SimpleEntityFilter): Long {

        val whereClause = filter.whereClause(this.fieldConverter)
        val sqlParams = SqlParams()

        filter.populateSqlParams(sqlParams)

        return jdbcOps.queryForLong(
            """
            select count(*) from testing.simple
            where $whereClause
            """.trimIndent(),
            sqlParams
        )

    }


    @Throws(EntityNotFoundException::class)
    fun findByPrimaryKey(id: DomainId): SimpleEntity {

        return findByPrimaryKeyOrNull(id)
            ?: throw EntityNotFoundException(
                EntityClassAndPk(
                    SimpleEntity::class.java,
                    mapOf(
                        "id" to id,
                    )
                ),
                SimpleEntityMeta.TABLE_NAME
            )

    }


    fun findByPrimaryKeyOrNull(id: DomainId): SimpleEntity? {

        return jdbcOps.queryForList(
            "select * from testing.simple where id = :id",
            SqlParams().apply {
            addValue("id", id)
            },
            this.entityRowMapper
        ).firstOrNull()

    }


    fun existsByPrimaryKey(id: DomainId): Boolean {

        val count = jdbcOps.queryForInt(
            "select count(*) from testing.simple where id = :id",
            SqlParams().apply {
                addValue("id", id)
           }
        )
       
        return count > 0
       
    }

    fun findOneOrNullBySomeIntType(someIntType: SomeIntType): SimpleEntity? {

        return jdbcOps.queryForList(
            """
            select * from testing.simple
            where some_int_type = :someIntType
            """.trimIndent(),
            SqlParams().apply {
            addValue("someIntType", someIntType)
            },
            this.entityRowMapper
        ).firstOrNull()

    }


    @Throws(EntityNotFoundException::class)
    fun findOneBySomeIntType(someIntType: SomeIntType): SimpleEntity {

        return findOneOrNullBySomeIntType(someIntType)
            ?: throw EntityNotFoundException("No record with column [some_int_type = $someIntType] found in table testing.simple.", SimpleEntityMeta.TABLE_NAME)

    }


    fun findOneOrNullBySomeLongType(someLongType: SomeLongType): SimpleEntity? {

        return jdbcOps.queryForList(
            """
            select * from testing.simple
            where some_long_type = :someLongType
            """.trimIndent(),
            SqlParams().apply {
            addValue("someLongType", someLongType)
            },
            this.entityRowMapper
        ).firstOrNull()

    }


    @Throws(EntityNotFoundException::class)
    fun findOneBySomeLongType(someLongType: SomeLongType): SimpleEntity {

        return findOneOrNullBySomeLongType(someLongType)
            ?: throw EntityNotFoundException("No record with column [some_long_type = $someLongType] found in table testing.simple.", SimpleEntityMeta.TABLE_NAME)

    }


    fun findOneOrNullBySomeString(someString: String): SimpleEntity? {

        return jdbcOps.queryForList(
            """
            select * from testing.simple
            where some_string = :someString
            """.trimIndent(),
            SqlParams().apply {
            addValue("someString", someString)
            },
            this.entityRowMapper
        ).firstOrNull()

    }


    @Throws(EntityNotFoundException::class)
    fun findOneBySomeString(someString: String): SimpleEntity {

        return findOneOrNullBySomeString(someString)
            ?: throw EntityNotFoundException("No record with column [some_string = $someString] found in table testing.simple.", SimpleEntityMeta.TABLE_NAME)

    }


    fun findOneOrNullBySomeStringNullable(someStringNullable: String): SimpleEntity? {

        return jdbcOps.queryForList(
            """
            select * from testing.simple
            where some_string_nullable = :someStringNullable
            """.trimIndent(),
            SqlParams().apply {
            addValue("someStringNullable", someStringNullable)
            },
            this.entityRowMapper
        ).firstOrNull()

    }


    @Throws(EntityNotFoundException::class)
    fun findOneBySomeStringNullable(someStringNullable: String): SimpleEntity {

        return findOneOrNullBySomeStringNullable(someStringNullable)
            ?: throw EntityNotFoundException("No record with column [some_string_nullable = $someStringNullable] found in table testing.simple.", SimpleEntityMeta.TABLE_NAME)

    }


    fun findOneOrNullBySomeStringType(someStringType: SomeStringType): SimpleEntity? {

        return jdbcOps.queryForList(
            """
            select * from testing.simple
            where some_string_type = :someStringType
            """.trimIndent(),
            SqlParams().apply {
            addValue("someStringType", someStringType)
            },
            this.entityRowMapper
        ).firstOrNull()

    }


    @Throws(EntityNotFoundException::class)
    fun findOneBySomeStringType(someStringType: SomeStringType): SimpleEntity {

        return findOneOrNullBySomeStringType(someStringType)
            ?: throw EntityNotFoundException("No record with column [some_string_type = $someStringType] found in table testing.simple.", SimpleEntityMeta.TABLE_NAME)

    }


    fun findBySomeBooleanAndSomeStringModifiable(
        someBoolean: Boolean,
        someStringModifiable: String
    ): List<SimpleEntity> {

        return jdbcOps.queryForList(
            """
            select * from testing.simple
            where some_boolean = :someBoolean
            and some_string_modifiable = :someStringModifiable
            """.trimIndent(),
            SqlParams().apply {
            addValue("someBoolean", someBoolean)
            addValue("someStringModifiable", someStringModifiable)
            },
            this.entityRowMapper
        )

    }


    fun findAll(): List<SimpleEntity> {

        return this.jdbcOps.queryForList(
            "select * from testing.simple",
            SqlParams(),
            this.entityRowMapper
        )

    }


    fun findAllBy(filter: SimpleEntityFilter): List<SimpleEntity> {

        val whereClause = filter.whereClause(this.fieldConverter)
        val sqlParams = SqlParams()

        filter.populateSqlParams(sqlParams)

        return this.jdbcOps.queryForList(
            "select * from testing.simple where $whereClause",
            sqlParams,
            this.entityRowMapper
        )

    }


    fun findAllByFilterAsSequence(filter: SimpleEntityFilter): Sequence<SimpleEntity> {

        val whereClause = filter.whereClause(this.fieldConverter)
        val sqlParams = SqlParams()

        filter.populateSqlParams(sqlParams)

        return this.jdbcOps.queryForSequence(
            "select * from testing.simple where $whereClause",
            sqlParams,
            this.entityRowMapper
        )

    }


    fun findIdsAsSequence(filter: SimpleEntityFilter): Sequence<DomainId> {

        val whereClause = filter.whereClause(this.fieldConverter)
        val sqlParams = SqlParams()

        filter.populateSqlParams(sqlParams)

        return this.jdbcOps.queryForSequence(
            "select id from testing.simple where $whereClause",
            sqlParams,
            { rsa -> rsa.readDomainId("id") }
        )

    }


    fun findAllPrimaryKeysAsSequence(): Sequence<DomainId> {

        return this.jdbcOps.queryForSequence(
            "select id from testing.simple;",
            SqlParams(),
            { rsa -> rsa.readDomainId("id") }
        )

    }


    fun findAllBy(filter: SimpleEntityFilter, pageable: Pageable): List<SimpleEntity> {

        val whereClause = filter.whereClause(this.fieldConverter)
        val orderByClause = orderByClauseFor(pageable)
        val limitClause = limitClauseFor(pageable)
        val offsetClause = offsetClauseFor(pageable)

        val sqlParams = SqlParams()

        filter.populateSqlParams(sqlParams)

        return this.jdbcOps.queryForList(
            "select * from testing.simple where $whereClause $orderByClause $limitClause $offsetClause",
            sqlParams,
            this.entityRowMapper
        )

    }


    private fun orderByClauseFor(pageable: Pageable): String {

        val properties = pageable.sort.map { "${it.property} ${it.direction}" }.joinToString(", ")
        return "ORDER BY $properties"

    }


    private fun limitClauseFor(pageable: Pageable): String {

        return "LIMIT ${pageable.pageSize}"

    }


    private fun offsetClauseFor(pageable: Pageable): String {

        return "OFFSET ${pageable.offset}"

    }


    fun findAllAsSequence(): Sequence<SimpleEntity> {

        return this.jdbcOps.queryForSequence(
            "select * from testing.simple;",
            SqlParams(),
            this.entityRowMapper,
        )

    }


    fun existsBySomeIntType(someIntType: SomeIntType): Boolean {

        val count = jdbcOps.queryForInt(
            """
            select count(*) from testing.simple
            where some_int_type = :someIntType
            """.trimIndent(),
            SqlParams().apply {
            addValue("someIntType", someIntType)
            }
        )

        return count > 0

    }


    fun existsBySomeLongType(someLongType: SomeLongType): Boolean {

        val count = jdbcOps.queryForInt(
            """
            select count(*) from testing.simple
            where some_long_type = :someLongType
            """.trimIndent(),
            SqlParams().apply {
            addValue("someLongType", someLongType)
            }
        )

        return count > 0

    }


    fun existsBySomeString(someString: String): Boolean {

        val count = jdbcOps.queryForInt(
            """
            select count(*) from testing.simple
            where some_string = :someString
            """.trimIndent(),
            SqlParams().apply {
            addValue("someString", someString)
            }
        )

        return count > 0

    }


    fun existsBySomeStringNullable(someStringNullable: String): Boolean {

        val count = jdbcOps.queryForInt(
            """
            select count(*) from testing.simple
            where some_string_nullable = :someStringNullable
            """.trimIndent(),
            SqlParams().apply {
            addValue("someStringNullable", someStringNullable)
            }
        )

        return count > 0

    }


    fun existsBySomeStringType(someStringType: SomeStringType): Boolean {

        val count = jdbcOps.queryForInt(
            """
            select count(*) from testing.simple
            where some_string_type = :someStringType
            """.trimIndent(),
            SqlParams().apply {
            addValue("someStringType", someStringType)
            }
        )

        return count > 0

    }


    fun existsByCreatedById(createdById: DomainId): Boolean {

        val count = jdbcOps.queryForInt(
            """
            select count(*) from testing.simple
            where created_by_id = :createdById
            """.trimIndent(),
            SqlParams().apply {
            addValue("createdById", createdById)
            }
        )

        return count > 0

    }


    fun existsByLastModifiedById(lastModifiedById: DomainId): Boolean {

        val count = jdbcOps.queryForInt(
            """
            select count(*) from testing.simple
            where lm_by_id = :lastModifiedById
            """.trimIndent(),
            SqlParams().apply {
            addValue("lastModifiedById", lastModifiedById)
            }
        )

        return count > 0

    }


    fun fetchForEdit(id: DomainId): SimpleFetchForEditDto {

        return this.jdbcOps.queryForList(
            """
            select
                created_by_v_party.id as createdById,
                created_by_v_party.display_name as createdByName,
                simple.created_by_name as createdByUsername,
                simple.c_ts as createdTimestampUtc,
                simple.id as id,
                last_modified_by_v_party.id as lastModifiedById,
                last_modified_by_v_party.display_name as lastModifiedByName,
                simple.lm_by_name as lastModifiedByUsername,
                simple.lm_ts as lastModifiedTimestampUtc,
                simple.some_boolean as someBoolean,
                simple.some_boolean_nullable as someBooleanNullable,
                simple.some_boolean_type as someBooleanType,
                simple.some_boolean_type_nullable as someBooleanTypeNullable,
                simple.some_boolean_type_provided as someBooleanTypeProvided,
                simple.some_boolean_type_provided_nullable as someBooleanTypeProvidedNullable,
                simple.some_dto as someDto,
                simple.some_dto_nullable as someDtoNullable,
                simple.some_enum as someEnum,
                simple.some_enum_nullable as someEnumNullable,
                simple.some_instant as someInstant,
                simple.some_instant_modifiable as someInstantModifiable,
                simple.some_instant_modifiable_nullable as someInstantModifiableNullable,
                simple.some_instant_nullable as someInstantNullable,
                simple.some_int as someInt,
                simple.some_int_modifiable as someIntModifiable,
                simple.some_int_nullable as someIntNullable,
                simple.some_int_type as someIntType,
                simple.some_int_type_nullable as someIntTypeNullable,
                simple.some_int_type_provided as someIntTypeProvided,
                simple.some_int_type_provided_nullable as someIntTypeProvidedNullable,
                simple.some_list_of_enums as someListOfEnums,
                simple.some_list_of_instants as someListOfInstants,
                simple.some_list_of_local_dates as someListOfLocalDates,
                simple.some_list_of_periods as someListOfPeriods,
                simple.some_list_of_string_types as someListOfStringTypes,
                simple.some_list_of_strings as someListOfStrings,
                simple.some_local_date_modifiable as someLocalDateModifiable,
                simple.some_long_type as someLongType,
                simple.some_long_type_nullable as someLongTypeNullable,
                simple.some_long_type_provided as someLongTypeProvided,
                simple.some_long_type_provided_nullable as someLongTypeProvidedNullable,
                simple.some_map_of_string_to_integer as someMapOfStringToInteger,
                simple.some_map_of_string_type_to_string_type as someMapOfStringTypeToStringType,
                simple.some_period_modifiable as somePeriodModifiable,
                simple.some_period_nullable as somePeriodNullable,
                simple.some_provided_string_type as someProvidedStringType,
                simple.some_provided_string_type_nullable as someProvidedStringTypeNullable,
                simple.some_string as someString,
                simple.some_string_modifiable as someStringModifiable,
                simple.some_string_nullable as someStringNullable,
                simple.some_string_type as someStringType,
                simple.some_string_type_nullable as someStringTypeNullable
            from testing.simple
            join testing.v_party created_by_v_party
                on created_by_v_party.id = simple.created_by_id
            join testing.v_party last_modified_by_v_party
                on last_modified_by_v_party.id = simple.lm_by_id
            where simple.id = :id
            """,
            SqlParams().apply {
                addValue("id", id)
            },
            this.fetchForEditDtoRowMapper
        ).firstOrNull()
            ?: throw EntityNotFoundException(EntityClassAndPk(SimpleEntity::class.java, mapOf("id" to id)), SimpleEntityMeta.TABLE_NAME)

    }


    fun upsertBySomeIntType(upsertEntity: SimpleEntity): SimpleEntity {

        val persistedEntity = jdbcOps.execute(
            """
            insert into testing.simple (
                created_by_id,
                created_by_name,
                c_ts,
                id,
                lm_by_id,
                lm_by_name,
                lm_ts,
                some_boolean,
                some_boolean_nullable,
                some_boolean_type,
                some_boolean_type_nullable,
                some_boolean_type_provided,
                some_boolean_type_provided_nullable,
                some_dto,
                some_dto_nullable,
                some_enum,
                some_enum_nullable,
                some_instant,
                some_instant_modifiable,
                some_instant_modifiable_nullable,
                some_instant_nullable,
                some_int,
                some_int_modifiable,
                some_int_nullable,
                some_int_type,
                some_int_type_nullable,
                some_int_type_provided,
                some_int_type_provided_nullable,
                some_list_of_enums,
                some_list_of_instants,
                some_list_of_local_dates,
                some_list_of_periods,
                some_list_of_string_types,
                some_list_of_strings,
                some_local_date_modifiable,
                some_long_type,
                some_long_type_nullable,
                some_long_type_provided,
                some_long_type_provided_nullable,
                some_map_of_string_to_integer,
                some_map_of_string_type_to_string_type,
                some_period_modifiable,
                some_period_nullable,
                some_provided_string_type,
                some_provided_string_type_nullable,
                some_string,
                some_string_modifiable,
                some_string_nullable,
                some_string_type,
                some_string_type_nullable
            ) values (
                :createdById,
                :createdByUsername,
                :createdTimestampUtc,
                :id,
                :lastModifiedById,
                :lastModifiedByUsername,
                :lastModifiedTimestampUtc,
                :someBoolean,
                :someBooleanNullable,
                :someBooleanType,
                :someBooleanTypeNullable,
                :someBooleanTypeProvided,
                :someBooleanTypeProvidedNullable,
                :someDto,
                :someDtoNullable,
                :someEnum,
                :someEnumNullable,
                :someInstant,
                :someInstantModifiable,
                :someInstantModifiableNullable,
                :someInstantNullable,
                :someInt,
                :someIntModifiable,
                :someIntNullable,
                :someIntType,
                :someIntTypeNullable,
                :someIntTypeProvided,
                :someIntTypeProvidedNullable,
                :someListOfEnums,
                :someListOfInstants,
                :someListOfLocalDates,
                :someListOfPeriods,
                :someListOfStringTypes,
                :someListOfStrings,
                :someLocalDateModifiable,
                :someLongType,
                :someLongTypeNullable,
                :someLongTypeProvided,
                :someLongTypeProvidedNullable,
                :someMapOfStringToInteger,
                :someMapOfStringTypeToStringType,
                :somePeriodModifiable,
                :somePeriodNullable,
                :someProvidedStringType,
                :someProvidedStringTypeNullable,
                :someString,
                :someStringModifiable,
                :someStringNullable,
                :someStringType,
                :someStringTypeNullable
            )
            on conflict (some_int_type)
            do update set
                lm_by_id = :lastModifiedById,
                lm_by_name = :lastModifiedByUsername,
                lm_ts = :lastModifiedTimestampUtc,
                some_instant_modifiable = :someInstantModifiable,
                some_instant_modifiable_nullable = :someInstantModifiableNullable,
                some_int_modifiable = :someIntModifiable,
                some_int_nullable = :someIntNullable,
                some_list_of_strings = :someListOfStrings,
                some_local_date_modifiable = :someLocalDateModifiable,
                some_period_modifiable = :somePeriodModifiable,
                some_string_modifiable = :someStringModifiable
            returning *;
            """.trimIndent(),
            SqlParams().apply {
            addValue("createdById", upsertEntity.createdById)
            addValue("createdByUsername", upsertEntity.createdByUsername)
            addValue("createdTimestampUtc", upsertEntity.createdTimestampUtc)
            addValue("id", upsertEntity.id)
            addValue("lastModifiedById", upsertEntity.lastModifiedById)
            addValue("lastModifiedByUsername", upsertEntity.lastModifiedByUsername)
            addValue("lastModifiedTimestampUtc", upsertEntity.lastModifiedTimestampUtc)
            addValue("someBoolean", upsertEntity.someBoolean)
            addValue("someBooleanNullable", upsertEntity.someBooleanNullable)
            addValue("someBooleanType", upsertEntity.someBooleanType)
            addValue("someBooleanTypeNullable", upsertEntity.someBooleanTypeNullable)
            addValue("someBooleanTypeProvided", upsertEntity.someBooleanTypeProvided)
            addValue("someBooleanTypeProvidedNullable", upsertEntity.someBooleanTypeProvidedNullable)
            addJsonValue("someDto", objectMapper.writeValueAsString(upsertEntity.someDto))
            addJsonValue("someDtoNullable", upsertEntity.someDtoNullable?.let { objectMapper.writeValueAsString(it) })
            addValue("someEnum", upsertEntity.someEnum)
            addValue("someEnumNullable", upsertEntity.someEnumNullable)
            addValue("someInstant", upsertEntity.someInstant)
            addValue("someInstantModifiable", upsertEntity.someInstantModifiable)
            addValue("someInstantModifiableNullable", upsertEntity.someInstantModifiableNullable)
            addValue("someInstantNullable", upsertEntity.someInstantNullable)
            addValue("someInt", upsertEntity.someInt)
            addValue("someIntModifiable", upsertEntity.someIntModifiable)
            addValue("someIntNullable", upsertEntity.someIntNullable)
            addValue("someIntType", upsertEntity.someIntType)
            addValue("someIntTypeNullable", upsertEntity.someIntTypeNullable)
            addValue("someIntTypeProvided", upsertEntity.someIntTypeProvided)
            addValue("someIntTypeProvidedNullable", upsertEntity.someIntTypeProvidedNullable)
            addListOfStrings("someListOfEnums", upsertEntity.someListOfEnums.map { it.name })
            addListOfInstants("someListOfInstants", upsertEntity.someListOfInstants)
            addListOfLocalDates("someListOfLocalDates", upsertEntity.someListOfLocalDates)
            addListOfStrings("someListOfPeriods", upsertEntity.someListOfPeriods.map { it.toString() })
            addListOfStrings("someListOfStringTypes", upsertEntity.someListOfStringTypes.map { it.value })
            addListOfStrings("someListOfStrings", upsertEntity.someListOfStrings)
            addValue("someLocalDateModifiable", upsertEntity.someLocalDateModifiable)
            addValue("someLongType", upsertEntity.someLongType)
            addValue("someLongTypeNullable", upsertEntity.someLongTypeNullable)
            addValue("someLongTypeProvided", upsertEntity.someLongTypeProvided)
            addValue("someLongTypeProvidedNullable", upsertEntity.someLongTypeProvidedNullable)
            addJsonValue("someMapOfStringToInteger", objectMapper.writeValueAsString(upsertEntity.someMapOfStringToInteger))
            addJsonValue("someMapOfStringTypeToStringType", objectMapper.writeValueAsString(upsertEntity.someMapOfStringTypeToStringType))
            addValue("somePeriodModifiable", upsertEntity.somePeriodModifiable)
            addValue("somePeriodNullable", upsertEntity.somePeriodNullable)
            addValue("someProvidedStringType", upsertEntity.someProvidedStringType)
            addValue("someProvidedStringTypeNullable", upsertEntity.someProvidedStringTypeNullable)
            addValue("someString", upsertEntity.someString)
            addValue("someStringModifiable", upsertEntity.someStringModifiable)
            addValue("someStringNullable", upsertEntity.someStringNullable)
            addValue("someStringType", upsertEntity.someStringType)
            addValue("someStringTypeNullable", upsertEntity.someStringTypeNullable)
            },
            { ps: PreparedStatement ->
                val rs = ps.executeQuery()
                rs.next()
                entityRowMapper.mapRow(ResultSetAdapter(rs))
            }
        )

        return persistedEntity!!

    }


    fun upsertBySomeLongType(upsertEntity: SimpleEntity): SimpleEntity {

        val persistedEntity = jdbcOps.execute(
            """
            insert into testing.simple (
                created_by_id,
                created_by_name,
                c_ts,
                id,
                lm_by_id,
                lm_by_name,
                lm_ts,
                some_boolean,
                some_boolean_nullable,
                some_boolean_type,
                some_boolean_type_nullable,
                some_boolean_type_provided,
                some_boolean_type_provided_nullable,
                some_dto,
                some_dto_nullable,
                some_enum,
                some_enum_nullable,
                some_instant,
                some_instant_modifiable,
                some_instant_modifiable_nullable,
                some_instant_nullable,
                some_int,
                some_int_modifiable,
                some_int_nullable,
                some_int_type,
                some_int_type_nullable,
                some_int_type_provided,
                some_int_type_provided_nullable,
                some_list_of_enums,
                some_list_of_instants,
                some_list_of_local_dates,
                some_list_of_periods,
                some_list_of_string_types,
                some_list_of_strings,
                some_local_date_modifiable,
                some_long_type,
                some_long_type_nullable,
                some_long_type_provided,
                some_long_type_provided_nullable,
                some_map_of_string_to_integer,
                some_map_of_string_type_to_string_type,
                some_period_modifiable,
                some_period_nullable,
                some_provided_string_type,
                some_provided_string_type_nullable,
                some_string,
                some_string_modifiable,
                some_string_nullable,
                some_string_type,
                some_string_type_nullable
            ) values (
                :createdById,
                :createdByUsername,
                :createdTimestampUtc,
                :id,
                :lastModifiedById,
                :lastModifiedByUsername,
                :lastModifiedTimestampUtc,
                :someBoolean,
                :someBooleanNullable,
                :someBooleanType,
                :someBooleanTypeNullable,
                :someBooleanTypeProvided,
                :someBooleanTypeProvidedNullable,
                :someDto,
                :someDtoNullable,
                :someEnum,
                :someEnumNullable,
                :someInstant,
                :someInstantModifiable,
                :someInstantModifiableNullable,
                :someInstantNullable,
                :someInt,
                :someIntModifiable,
                :someIntNullable,
                :someIntType,
                :someIntTypeNullable,
                :someIntTypeProvided,
                :someIntTypeProvidedNullable,
                :someListOfEnums,
                :someListOfInstants,
                :someListOfLocalDates,
                :someListOfPeriods,
                :someListOfStringTypes,
                :someListOfStrings,
                :someLocalDateModifiable,
                :someLongType,
                :someLongTypeNullable,
                :someLongTypeProvided,
                :someLongTypeProvidedNullable,
                :someMapOfStringToInteger,
                :someMapOfStringTypeToStringType,
                :somePeriodModifiable,
                :somePeriodNullable,
                :someProvidedStringType,
                :someProvidedStringTypeNullable,
                :someString,
                :someStringModifiable,
                :someStringNullable,
                :someStringType,
                :someStringTypeNullable
            )
            on conflict (some_long_type)
            do update set
                lm_by_id = :lastModifiedById,
                lm_by_name = :lastModifiedByUsername,
                lm_ts = :lastModifiedTimestampUtc,
                some_instant_modifiable = :someInstantModifiable,
                some_instant_modifiable_nullable = :someInstantModifiableNullable,
                some_int_modifiable = :someIntModifiable,
                some_int_nullable = :someIntNullable,
                some_list_of_strings = :someListOfStrings,
                some_local_date_modifiable = :someLocalDateModifiable,
                some_period_modifiable = :somePeriodModifiable,
                some_string_modifiable = :someStringModifiable
            returning *;
            """.trimIndent(),
            SqlParams().apply {
            addValue("createdById", upsertEntity.createdById)
            addValue("createdByUsername", upsertEntity.createdByUsername)
            addValue("createdTimestampUtc", upsertEntity.createdTimestampUtc)
            addValue("id", upsertEntity.id)
            addValue("lastModifiedById", upsertEntity.lastModifiedById)
            addValue("lastModifiedByUsername", upsertEntity.lastModifiedByUsername)
            addValue("lastModifiedTimestampUtc", upsertEntity.lastModifiedTimestampUtc)
            addValue("someBoolean", upsertEntity.someBoolean)
            addValue("someBooleanNullable", upsertEntity.someBooleanNullable)
            addValue("someBooleanType", upsertEntity.someBooleanType)
            addValue("someBooleanTypeNullable", upsertEntity.someBooleanTypeNullable)
            addValue("someBooleanTypeProvided", upsertEntity.someBooleanTypeProvided)
            addValue("someBooleanTypeProvidedNullable", upsertEntity.someBooleanTypeProvidedNullable)
            addJsonValue("someDto", objectMapper.writeValueAsString(upsertEntity.someDto))
            addJsonValue("someDtoNullable", upsertEntity.someDtoNullable?.let { objectMapper.writeValueAsString(it) })
            addValue("someEnum", upsertEntity.someEnum)
            addValue("someEnumNullable", upsertEntity.someEnumNullable)
            addValue("someInstant", upsertEntity.someInstant)
            addValue("someInstantModifiable", upsertEntity.someInstantModifiable)
            addValue("someInstantModifiableNullable", upsertEntity.someInstantModifiableNullable)
            addValue("someInstantNullable", upsertEntity.someInstantNullable)
            addValue("someInt", upsertEntity.someInt)
            addValue("someIntModifiable", upsertEntity.someIntModifiable)
            addValue("someIntNullable", upsertEntity.someIntNullable)
            addValue("someIntType", upsertEntity.someIntType)
            addValue("someIntTypeNullable", upsertEntity.someIntTypeNullable)
            addValue("someIntTypeProvided", upsertEntity.someIntTypeProvided)
            addValue("someIntTypeProvidedNullable", upsertEntity.someIntTypeProvidedNullable)
            addListOfStrings("someListOfEnums", upsertEntity.someListOfEnums.map { it.name })
            addListOfInstants("someListOfInstants", upsertEntity.someListOfInstants)
            addListOfLocalDates("someListOfLocalDates", upsertEntity.someListOfLocalDates)
            addListOfStrings("someListOfPeriods", upsertEntity.someListOfPeriods.map { it.toString() })
            addListOfStrings("someListOfStringTypes", upsertEntity.someListOfStringTypes.map { it.value })
            addListOfStrings("someListOfStrings", upsertEntity.someListOfStrings)
            addValue("someLocalDateModifiable", upsertEntity.someLocalDateModifiable)
            addValue("someLongType", upsertEntity.someLongType)
            addValue("someLongTypeNullable", upsertEntity.someLongTypeNullable)
            addValue("someLongTypeProvided", upsertEntity.someLongTypeProvided)
            addValue("someLongTypeProvidedNullable", upsertEntity.someLongTypeProvidedNullable)
            addJsonValue("someMapOfStringToInteger", objectMapper.writeValueAsString(upsertEntity.someMapOfStringToInteger))
            addJsonValue("someMapOfStringTypeToStringType", objectMapper.writeValueAsString(upsertEntity.someMapOfStringTypeToStringType))
            addValue("somePeriodModifiable", upsertEntity.somePeriodModifiable)
            addValue("somePeriodNullable", upsertEntity.somePeriodNullable)
            addValue("someProvidedStringType", upsertEntity.someProvidedStringType)
            addValue("someProvidedStringTypeNullable", upsertEntity.someProvidedStringTypeNullable)
            addValue("someString", upsertEntity.someString)
            addValue("someStringModifiable", upsertEntity.someStringModifiable)
            addValue("someStringNullable", upsertEntity.someStringNullable)
            addValue("someStringType", upsertEntity.someStringType)
            addValue("someStringTypeNullable", upsertEntity.someStringTypeNullable)
            },
            { ps: PreparedStatement ->
                val rs = ps.executeQuery()
                rs.next()
                entityRowMapper.mapRow(ResultSetAdapter(rs))
            }
        )

        return persistedEntity!!

    }


    fun upsertBySomeString(upsertEntity: SimpleEntity): SimpleEntity {

        val persistedEntity = jdbcOps.execute(
            """
            insert into testing.simple (
                created_by_id,
                created_by_name,
                c_ts,
                id,
                lm_by_id,
                lm_by_name,
                lm_ts,
                some_boolean,
                some_boolean_nullable,
                some_boolean_type,
                some_boolean_type_nullable,
                some_boolean_type_provided,
                some_boolean_type_provided_nullable,
                some_dto,
                some_dto_nullable,
                some_enum,
                some_enum_nullable,
                some_instant,
                some_instant_modifiable,
                some_instant_modifiable_nullable,
                some_instant_nullable,
                some_int,
                some_int_modifiable,
                some_int_nullable,
                some_int_type,
                some_int_type_nullable,
                some_int_type_provided,
                some_int_type_provided_nullable,
                some_list_of_enums,
                some_list_of_instants,
                some_list_of_local_dates,
                some_list_of_periods,
                some_list_of_string_types,
                some_list_of_strings,
                some_local_date_modifiable,
                some_long_type,
                some_long_type_nullable,
                some_long_type_provided,
                some_long_type_provided_nullable,
                some_map_of_string_to_integer,
                some_map_of_string_type_to_string_type,
                some_period_modifiable,
                some_period_nullable,
                some_provided_string_type,
                some_provided_string_type_nullable,
                some_string,
                some_string_modifiable,
                some_string_nullable,
                some_string_type,
                some_string_type_nullable
            ) values (
                :createdById,
                :createdByUsername,
                :createdTimestampUtc,
                :id,
                :lastModifiedById,
                :lastModifiedByUsername,
                :lastModifiedTimestampUtc,
                :someBoolean,
                :someBooleanNullable,
                :someBooleanType,
                :someBooleanTypeNullable,
                :someBooleanTypeProvided,
                :someBooleanTypeProvidedNullable,
                :someDto,
                :someDtoNullable,
                :someEnum,
                :someEnumNullable,
                :someInstant,
                :someInstantModifiable,
                :someInstantModifiableNullable,
                :someInstantNullable,
                :someInt,
                :someIntModifiable,
                :someIntNullable,
                :someIntType,
                :someIntTypeNullable,
                :someIntTypeProvided,
                :someIntTypeProvidedNullable,
                :someListOfEnums,
                :someListOfInstants,
                :someListOfLocalDates,
                :someListOfPeriods,
                :someListOfStringTypes,
                :someListOfStrings,
                :someLocalDateModifiable,
                :someLongType,
                :someLongTypeNullable,
                :someLongTypeProvided,
                :someLongTypeProvidedNullable,
                :someMapOfStringToInteger,
                :someMapOfStringTypeToStringType,
                :somePeriodModifiable,
                :somePeriodNullable,
                :someProvidedStringType,
                :someProvidedStringTypeNullable,
                :someString,
                :someStringModifiable,
                :someStringNullable,
                :someStringType,
                :someStringTypeNullable
            )
            on conflict (some_string)
            do update set
                lm_by_id = :lastModifiedById,
                lm_by_name = :lastModifiedByUsername,
                lm_ts = :lastModifiedTimestampUtc,
                some_instant_modifiable = :someInstantModifiable,
                some_instant_modifiable_nullable = :someInstantModifiableNullable,
                some_int_modifiable = :someIntModifiable,
                some_int_nullable = :someIntNullable,
                some_list_of_strings = :someListOfStrings,
                some_local_date_modifiable = :someLocalDateModifiable,
                some_period_modifiable = :somePeriodModifiable,
                some_string_modifiable = :someStringModifiable
            returning *;
            """.trimIndent(),
            SqlParams().apply {
            addValue("createdById", upsertEntity.createdById)
            addValue("createdByUsername", upsertEntity.createdByUsername)
            addValue("createdTimestampUtc", upsertEntity.createdTimestampUtc)
            addValue("id", upsertEntity.id)
            addValue("lastModifiedById", upsertEntity.lastModifiedById)
            addValue("lastModifiedByUsername", upsertEntity.lastModifiedByUsername)
            addValue("lastModifiedTimestampUtc", upsertEntity.lastModifiedTimestampUtc)
            addValue("someBoolean", upsertEntity.someBoolean)
            addValue("someBooleanNullable", upsertEntity.someBooleanNullable)
            addValue("someBooleanType", upsertEntity.someBooleanType)
            addValue("someBooleanTypeNullable", upsertEntity.someBooleanTypeNullable)
            addValue("someBooleanTypeProvided", upsertEntity.someBooleanTypeProvided)
            addValue("someBooleanTypeProvidedNullable", upsertEntity.someBooleanTypeProvidedNullable)
            addJsonValue("someDto", objectMapper.writeValueAsString(upsertEntity.someDto))
            addJsonValue("someDtoNullable", upsertEntity.someDtoNullable?.let { objectMapper.writeValueAsString(it) })
            addValue("someEnum", upsertEntity.someEnum)
            addValue("someEnumNullable", upsertEntity.someEnumNullable)
            addValue("someInstant", upsertEntity.someInstant)
            addValue("someInstantModifiable", upsertEntity.someInstantModifiable)
            addValue("someInstantModifiableNullable", upsertEntity.someInstantModifiableNullable)
            addValue("someInstantNullable", upsertEntity.someInstantNullable)
            addValue("someInt", upsertEntity.someInt)
            addValue("someIntModifiable", upsertEntity.someIntModifiable)
            addValue("someIntNullable", upsertEntity.someIntNullable)
            addValue("someIntType", upsertEntity.someIntType)
            addValue("someIntTypeNullable", upsertEntity.someIntTypeNullable)
            addValue("someIntTypeProvided", upsertEntity.someIntTypeProvided)
            addValue("someIntTypeProvidedNullable", upsertEntity.someIntTypeProvidedNullable)
            addListOfStrings("someListOfEnums", upsertEntity.someListOfEnums.map { it.name })
            addListOfInstants("someListOfInstants", upsertEntity.someListOfInstants)
            addListOfLocalDates("someListOfLocalDates", upsertEntity.someListOfLocalDates)
            addListOfStrings("someListOfPeriods", upsertEntity.someListOfPeriods.map { it.toString() })
            addListOfStrings("someListOfStringTypes", upsertEntity.someListOfStringTypes.map { it.value })
            addListOfStrings("someListOfStrings", upsertEntity.someListOfStrings)
            addValue("someLocalDateModifiable", upsertEntity.someLocalDateModifiable)
            addValue("someLongType", upsertEntity.someLongType)
            addValue("someLongTypeNullable", upsertEntity.someLongTypeNullable)
            addValue("someLongTypeProvided", upsertEntity.someLongTypeProvided)
            addValue("someLongTypeProvidedNullable", upsertEntity.someLongTypeProvidedNullable)
            addJsonValue("someMapOfStringToInteger", objectMapper.writeValueAsString(upsertEntity.someMapOfStringToInteger))
            addJsonValue("someMapOfStringTypeToStringType", objectMapper.writeValueAsString(upsertEntity.someMapOfStringTypeToStringType))
            addValue("somePeriodModifiable", upsertEntity.somePeriodModifiable)
            addValue("somePeriodNullable", upsertEntity.somePeriodNullable)
            addValue("someProvidedStringType", upsertEntity.someProvidedStringType)
            addValue("someProvidedStringTypeNullable", upsertEntity.someProvidedStringTypeNullable)
            addValue("someString", upsertEntity.someString)
            addValue("someStringModifiable", upsertEntity.someStringModifiable)
            addValue("someStringNullable", upsertEntity.someStringNullable)
            addValue("someStringType", upsertEntity.someStringType)
            addValue("someStringTypeNullable", upsertEntity.someStringTypeNullable)
            },
            { ps: PreparedStatement ->
                val rs = ps.executeQuery()
                rs.next()
                entityRowMapper.mapRow(ResultSetAdapter(rs))
            }
        )

        return persistedEntity!!

    }


    fun upsertBySomeStringNullable(upsertEntity: SimpleEntity): SimpleEntity {

        val persistedEntity = jdbcOps.execute(
            """
            insert into testing.simple (
                created_by_id,
                created_by_name,
                c_ts,
                id,
                lm_by_id,
                lm_by_name,
                lm_ts,
                some_boolean,
                some_boolean_nullable,
                some_boolean_type,
                some_boolean_type_nullable,
                some_boolean_type_provided,
                some_boolean_type_provided_nullable,
                some_dto,
                some_dto_nullable,
                some_enum,
                some_enum_nullable,
                some_instant,
                some_instant_modifiable,
                some_instant_modifiable_nullable,
                some_instant_nullable,
                some_int,
                some_int_modifiable,
                some_int_nullable,
                some_int_type,
                some_int_type_nullable,
                some_int_type_provided,
                some_int_type_provided_nullable,
                some_list_of_enums,
                some_list_of_instants,
                some_list_of_local_dates,
                some_list_of_periods,
                some_list_of_string_types,
                some_list_of_strings,
                some_local_date_modifiable,
                some_long_type,
                some_long_type_nullable,
                some_long_type_provided,
                some_long_type_provided_nullable,
                some_map_of_string_to_integer,
                some_map_of_string_type_to_string_type,
                some_period_modifiable,
                some_period_nullable,
                some_provided_string_type,
                some_provided_string_type_nullable,
                some_string,
                some_string_modifiable,
                some_string_nullable,
                some_string_type,
                some_string_type_nullable
            ) values (
                :createdById,
                :createdByUsername,
                :createdTimestampUtc,
                :id,
                :lastModifiedById,
                :lastModifiedByUsername,
                :lastModifiedTimestampUtc,
                :someBoolean,
                :someBooleanNullable,
                :someBooleanType,
                :someBooleanTypeNullable,
                :someBooleanTypeProvided,
                :someBooleanTypeProvidedNullable,
                :someDto,
                :someDtoNullable,
                :someEnum,
                :someEnumNullable,
                :someInstant,
                :someInstantModifiable,
                :someInstantModifiableNullable,
                :someInstantNullable,
                :someInt,
                :someIntModifiable,
                :someIntNullable,
                :someIntType,
                :someIntTypeNullable,
                :someIntTypeProvided,
                :someIntTypeProvidedNullable,
                :someListOfEnums,
                :someListOfInstants,
                :someListOfLocalDates,
                :someListOfPeriods,
                :someListOfStringTypes,
                :someListOfStrings,
                :someLocalDateModifiable,
                :someLongType,
                :someLongTypeNullable,
                :someLongTypeProvided,
                :someLongTypeProvidedNullable,
                :someMapOfStringToInteger,
                :someMapOfStringTypeToStringType,
                :somePeriodModifiable,
                :somePeriodNullable,
                :someProvidedStringType,
                :someProvidedStringTypeNullable,
                :someString,
                :someStringModifiable,
                :someStringNullable,
                :someStringType,
                :someStringTypeNullable
            )
            on conflict (some_string_nullable)
            do update set
                lm_by_id = :lastModifiedById,
                lm_by_name = :lastModifiedByUsername,
                lm_ts = :lastModifiedTimestampUtc,
                some_instant_modifiable = :someInstantModifiable,
                some_instant_modifiable_nullable = :someInstantModifiableNullable,
                some_int_modifiable = :someIntModifiable,
                some_int_nullable = :someIntNullable,
                some_list_of_strings = :someListOfStrings,
                some_local_date_modifiable = :someLocalDateModifiable,
                some_period_modifiable = :somePeriodModifiable,
                some_string_modifiable = :someStringModifiable
            returning *;
            """.trimIndent(),
            SqlParams().apply {
            addValue("createdById", upsertEntity.createdById)
            addValue("createdByUsername", upsertEntity.createdByUsername)
            addValue("createdTimestampUtc", upsertEntity.createdTimestampUtc)
            addValue("id", upsertEntity.id)
            addValue("lastModifiedById", upsertEntity.lastModifiedById)
            addValue("lastModifiedByUsername", upsertEntity.lastModifiedByUsername)
            addValue("lastModifiedTimestampUtc", upsertEntity.lastModifiedTimestampUtc)
            addValue("someBoolean", upsertEntity.someBoolean)
            addValue("someBooleanNullable", upsertEntity.someBooleanNullable)
            addValue("someBooleanType", upsertEntity.someBooleanType)
            addValue("someBooleanTypeNullable", upsertEntity.someBooleanTypeNullable)
            addValue("someBooleanTypeProvided", upsertEntity.someBooleanTypeProvided)
            addValue("someBooleanTypeProvidedNullable", upsertEntity.someBooleanTypeProvidedNullable)
            addJsonValue("someDto", objectMapper.writeValueAsString(upsertEntity.someDto))
            addJsonValue("someDtoNullable", upsertEntity.someDtoNullable?.let { objectMapper.writeValueAsString(it) })
            addValue("someEnum", upsertEntity.someEnum)
            addValue("someEnumNullable", upsertEntity.someEnumNullable)
            addValue("someInstant", upsertEntity.someInstant)
            addValue("someInstantModifiable", upsertEntity.someInstantModifiable)
            addValue("someInstantModifiableNullable", upsertEntity.someInstantModifiableNullable)
            addValue("someInstantNullable", upsertEntity.someInstantNullable)
            addValue("someInt", upsertEntity.someInt)
            addValue("someIntModifiable", upsertEntity.someIntModifiable)
            addValue("someIntNullable", upsertEntity.someIntNullable)
            addValue("someIntType", upsertEntity.someIntType)
            addValue("someIntTypeNullable", upsertEntity.someIntTypeNullable)
            addValue("someIntTypeProvided", upsertEntity.someIntTypeProvided)
            addValue("someIntTypeProvidedNullable", upsertEntity.someIntTypeProvidedNullable)
            addListOfStrings("someListOfEnums", upsertEntity.someListOfEnums.map { it.name })
            addListOfInstants("someListOfInstants", upsertEntity.someListOfInstants)
            addListOfLocalDates("someListOfLocalDates", upsertEntity.someListOfLocalDates)
            addListOfStrings("someListOfPeriods", upsertEntity.someListOfPeriods.map { it.toString() })
            addListOfStrings("someListOfStringTypes", upsertEntity.someListOfStringTypes.map { it.value })
            addListOfStrings("someListOfStrings", upsertEntity.someListOfStrings)
            addValue("someLocalDateModifiable", upsertEntity.someLocalDateModifiable)
            addValue("someLongType", upsertEntity.someLongType)
            addValue("someLongTypeNullable", upsertEntity.someLongTypeNullable)
            addValue("someLongTypeProvided", upsertEntity.someLongTypeProvided)
            addValue("someLongTypeProvidedNullable", upsertEntity.someLongTypeProvidedNullable)
            addJsonValue("someMapOfStringToInteger", objectMapper.writeValueAsString(upsertEntity.someMapOfStringToInteger))
            addJsonValue("someMapOfStringTypeToStringType", objectMapper.writeValueAsString(upsertEntity.someMapOfStringTypeToStringType))
            addValue("somePeriodModifiable", upsertEntity.somePeriodModifiable)
            addValue("somePeriodNullable", upsertEntity.somePeriodNullable)
            addValue("someProvidedStringType", upsertEntity.someProvidedStringType)
            addValue("someProvidedStringTypeNullable", upsertEntity.someProvidedStringTypeNullable)
            addValue("someString", upsertEntity.someString)
            addValue("someStringModifiable", upsertEntity.someStringModifiable)
            addValue("someStringNullable", upsertEntity.someStringNullable)
            addValue("someStringType", upsertEntity.someStringType)
            addValue("someStringTypeNullable", upsertEntity.someStringTypeNullable)
            },
            { ps: PreparedStatement ->
                val rs = ps.executeQuery()
                rs.next()
                entityRowMapper.mapRow(ResultSetAdapter(rs))
            }
        )

        return persistedEntity!!

    }


    fun upsertBySomeStringType(upsertEntity: SimpleEntity): SimpleEntity {

        val persistedEntity = jdbcOps.execute(
            """
            insert into testing.simple (
                created_by_id,
                created_by_name,
                c_ts,
                id,
                lm_by_id,
                lm_by_name,
                lm_ts,
                some_boolean,
                some_boolean_nullable,
                some_boolean_type,
                some_boolean_type_nullable,
                some_boolean_type_provided,
                some_boolean_type_provided_nullable,
                some_dto,
                some_dto_nullable,
                some_enum,
                some_enum_nullable,
                some_instant,
                some_instant_modifiable,
                some_instant_modifiable_nullable,
                some_instant_nullable,
                some_int,
                some_int_modifiable,
                some_int_nullable,
                some_int_type,
                some_int_type_nullable,
                some_int_type_provided,
                some_int_type_provided_nullable,
                some_list_of_enums,
                some_list_of_instants,
                some_list_of_local_dates,
                some_list_of_periods,
                some_list_of_string_types,
                some_list_of_strings,
                some_local_date_modifiable,
                some_long_type,
                some_long_type_nullable,
                some_long_type_provided,
                some_long_type_provided_nullable,
                some_map_of_string_to_integer,
                some_map_of_string_type_to_string_type,
                some_period_modifiable,
                some_period_nullable,
                some_provided_string_type,
                some_provided_string_type_nullable,
                some_string,
                some_string_modifiable,
                some_string_nullable,
                some_string_type,
                some_string_type_nullable
            ) values (
                :createdById,
                :createdByUsername,
                :createdTimestampUtc,
                :id,
                :lastModifiedById,
                :lastModifiedByUsername,
                :lastModifiedTimestampUtc,
                :someBoolean,
                :someBooleanNullable,
                :someBooleanType,
                :someBooleanTypeNullable,
                :someBooleanTypeProvided,
                :someBooleanTypeProvidedNullable,
                :someDto,
                :someDtoNullable,
                :someEnum,
                :someEnumNullable,
                :someInstant,
                :someInstantModifiable,
                :someInstantModifiableNullable,
                :someInstantNullable,
                :someInt,
                :someIntModifiable,
                :someIntNullable,
                :someIntType,
                :someIntTypeNullable,
                :someIntTypeProvided,
                :someIntTypeProvidedNullable,
                :someListOfEnums,
                :someListOfInstants,
                :someListOfLocalDates,
                :someListOfPeriods,
                :someListOfStringTypes,
                :someListOfStrings,
                :someLocalDateModifiable,
                :someLongType,
                :someLongTypeNullable,
                :someLongTypeProvided,
                :someLongTypeProvidedNullable,
                :someMapOfStringToInteger,
                :someMapOfStringTypeToStringType,
                :somePeriodModifiable,
                :somePeriodNullable,
                :someProvidedStringType,
                :someProvidedStringTypeNullable,
                :someString,
                :someStringModifiable,
                :someStringNullable,
                :someStringType,
                :someStringTypeNullable
            )
            on conflict (some_string_type)
            do update set
                lm_by_id = :lastModifiedById,
                lm_by_name = :lastModifiedByUsername,
                lm_ts = :lastModifiedTimestampUtc,
                some_instant_modifiable = :someInstantModifiable,
                some_instant_modifiable_nullable = :someInstantModifiableNullable,
                some_int_modifiable = :someIntModifiable,
                some_int_nullable = :someIntNullable,
                some_list_of_strings = :someListOfStrings,
                some_local_date_modifiable = :someLocalDateModifiable,
                some_period_modifiable = :somePeriodModifiable,
                some_string_modifiable = :someStringModifiable
            returning *;
            """.trimIndent(),
            SqlParams().apply {
            addValue("createdById", upsertEntity.createdById)
            addValue("createdByUsername", upsertEntity.createdByUsername)
            addValue("createdTimestampUtc", upsertEntity.createdTimestampUtc)
            addValue("id", upsertEntity.id)
            addValue("lastModifiedById", upsertEntity.lastModifiedById)
            addValue("lastModifiedByUsername", upsertEntity.lastModifiedByUsername)
            addValue("lastModifiedTimestampUtc", upsertEntity.lastModifiedTimestampUtc)
            addValue("someBoolean", upsertEntity.someBoolean)
            addValue("someBooleanNullable", upsertEntity.someBooleanNullable)
            addValue("someBooleanType", upsertEntity.someBooleanType)
            addValue("someBooleanTypeNullable", upsertEntity.someBooleanTypeNullable)
            addValue("someBooleanTypeProvided", upsertEntity.someBooleanTypeProvided)
            addValue("someBooleanTypeProvidedNullable", upsertEntity.someBooleanTypeProvidedNullable)
            addJsonValue("someDto", objectMapper.writeValueAsString(upsertEntity.someDto))
            addJsonValue("someDtoNullable", upsertEntity.someDtoNullable?.let { objectMapper.writeValueAsString(it) })
            addValue("someEnum", upsertEntity.someEnum)
            addValue("someEnumNullable", upsertEntity.someEnumNullable)
            addValue("someInstant", upsertEntity.someInstant)
            addValue("someInstantModifiable", upsertEntity.someInstantModifiable)
            addValue("someInstantModifiableNullable", upsertEntity.someInstantModifiableNullable)
            addValue("someInstantNullable", upsertEntity.someInstantNullable)
            addValue("someInt", upsertEntity.someInt)
            addValue("someIntModifiable", upsertEntity.someIntModifiable)
            addValue("someIntNullable", upsertEntity.someIntNullable)
            addValue("someIntType", upsertEntity.someIntType)
            addValue("someIntTypeNullable", upsertEntity.someIntTypeNullable)
            addValue("someIntTypeProvided", upsertEntity.someIntTypeProvided)
            addValue("someIntTypeProvidedNullable", upsertEntity.someIntTypeProvidedNullable)
            addListOfStrings("someListOfEnums", upsertEntity.someListOfEnums.map { it.name })
            addListOfInstants("someListOfInstants", upsertEntity.someListOfInstants)
            addListOfLocalDates("someListOfLocalDates", upsertEntity.someListOfLocalDates)
            addListOfStrings("someListOfPeriods", upsertEntity.someListOfPeriods.map { it.toString() })
            addListOfStrings("someListOfStringTypes", upsertEntity.someListOfStringTypes.map { it.value })
            addListOfStrings("someListOfStrings", upsertEntity.someListOfStrings)
            addValue("someLocalDateModifiable", upsertEntity.someLocalDateModifiable)
            addValue("someLongType", upsertEntity.someLongType)
            addValue("someLongTypeNullable", upsertEntity.someLongTypeNullable)
            addValue("someLongTypeProvided", upsertEntity.someLongTypeProvided)
            addValue("someLongTypeProvidedNullable", upsertEntity.someLongTypeProvidedNullable)
            addJsonValue("someMapOfStringToInteger", objectMapper.writeValueAsString(upsertEntity.someMapOfStringToInteger))
            addJsonValue("someMapOfStringTypeToStringType", objectMapper.writeValueAsString(upsertEntity.someMapOfStringTypeToStringType))
            addValue("somePeriodModifiable", upsertEntity.somePeriodModifiable)
            addValue("somePeriodNullable", upsertEntity.somePeriodNullable)
            addValue("someProvidedStringType", upsertEntity.someProvidedStringType)
            addValue("someProvidedStringTypeNullable", upsertEntity.someProvidedStringTypeNullable)
            addValue("someString", upsertEntity.someString)
            addValue("someStringModifiable", upsertEntity.someStringModifiable)
            addValue("someStringNullable", upsertEntity.someStringNullable)
            addValue("someStringType", upsertEntity.someStringType)
            addValue("someStringTypeNullable", upsertEntity.someStringTypeNullable)
            },
            { ps: PreparedStatement ->
                val rs = ps.executeQuery()
                rs.next()
                entityRowMapper.mapRow(ResultSetAdapter(rs))
            }
        )

        return persistedEntity!!

    }


    fun setFields(updaters: List<SimpleEntityUpdater>) {

        updaters.forEach { setFields(it) }

    }


    fun setFields(updater: SimpleEntityUpdater): Int {

        val sql = StringBuilder()
        val sqlParams = SqlParams()

        sql.append("update testing.simple set ")

        val fieldClauses = updater.fields
            .map { field ->

                addField(field, sqlParams)
                "${field.dbColumnName} = :${field.classFieldName}"

            }.joinToString(", ")

        sql.append(fieldClauses)
        sql.append(" where id = :id")

        sqlParams.addValue("id", updater.id)

        return this.jdbcOps.update(sql.toString(), sqlParams)

    }


    private fun addField(field: FieldUpdate, sqlParams: SqlParams) {

        when (field.classFieldName) {
            "lastModifiedById" -> sqlParams.addValue("lastModifiedById", field.value as DomainId)
            "lastModifiedByUsername" -> sqlParams.addValue("lastModifiedByUsername", field.value as String)
            "lastModifiedTimestampUtc" -> sqlParams.addValue("lastModifiedTimestampUtc", field.value as Instant)
            "someInstantModifiable" -> sqlParams.addValue("someInstantModifiable", field.value as Instant)
            "someInstantModifiableNullable" -> sqlParams.addValue("someInstantModifiableNullable", field.value as Instant?)
            "someIntModifiable" -> sqlParams.addValue("someIntModifiable", field.value as Int)
            "someIntNullable" -> sqlParams.addValue("someIntNullable", field.value as Int?)
            "someListOfStrings" -> sqlParams.addListOfStrings("someListOfStrings", field.value as List<String>)
            "someLocalDateModifiable" -> sqlParams.addValue("someLocalDateModifiable", field.value as LocalDate)
            "somePeriodModifiable" -> sqlParams.addValue("somePeriodModifiable", field.value as Period)
            "someStringModifiable" -> sqlParams.addValue("someStringModifiable", field.value as String)
        }

    }


    fun deleteByPrimaryKey(id: DomainId): Boolean {

        val existingEntity = findByPrimaryKeyOrNull(id)

        if (existingEntity == null) {
            return false
        }

        val deletedCount = this.jdbcOps.update(
            "delete from testing.simple where id = :id",
            SqlParams().apply {
                addValue("id", id)
            }
        )

        return deletedCount > 0

    }


    fun removeByPrimaryKey(id: DomainId): SimpleEntity? {

        val found = findByPrimaryKeyOrNull(id)

        if (found != null) {
            deleteByPrimaryKey(id)
        }

        return found

    }


    fun deleteAll() {
        this.jdbcOps.update("delete from testing.simple")
    }


    fun deleteBySomeIntType(someIntType: SomeIntType): Boolean {

        val existingEntity = findOneOrNullBySomeIntType(someIntType)

        if (existingEntity != null) {

            val deletedCount = this.jdbcOps.update(
                "delete from testing.simple where id = :id",
                SqlParams().apply {
                    addValue("id", existingEntity.id)
                }
            )

            return deletedCount > 0

        } else {

            return false

        }

    }


    fun deleteBySomeLongType(someLongType: SomeLongType): Boolean {

        val existingEntity = findOneOrNullBySomeLongType(someLongType)

        if (existingEntity != null) {

            val deletedCount = this.jdbcOps.update(
                "delete from testing.simple where id = :id",
                SqlParams().apply {
                    addValue("id", existingEntity.id)
                }
            )

            return deletedCount > 0

        } else {

            return false

        }

    }


    fun deleteBySomeString(someString: String): Boolean {

        val existingEntity = findOneOrNullBySomeString(someString)

        if (existingEntity != null) {

            val deletedCount = this.jdbcOps.update(
                "delete from testing.simple where id = :id",
                SqlParams().apply {
                    addValue("id", existingEntity.id)
                }
            )

            return deletedCount > 0

        } else {

            return false

        }

    }


    fun deleteBySomeStringNullable(someStringNullable: String): Boolean {

        val existingEntity = findOneOrNullBySomeStringNullable(someStringNullable)

        if (existingEntity != null) {

            val deletedCount = this.jdbcOps.update(
                "delete from testing.simple where id = :id",
                SqlParams().apply {
                    addValue("id", existingEntity.id)
                }
            )

            return deletedCount > 0

        } else {

            return false

        }

    }


    fun deleteBySomeStringType(someStringType: SomeStringType): Boolean {

        val existingEntity = findOneOrNullBySomeStringType(someStringType)

        if (existingEntity != null) {

            val deletedCount = this.jdbcOps.update(
                "delete from testing.simple where id = :id",
                SqlParams().apply {
                    addValue("id", existingEntity.id)
                }
            )

            return deletedCount > 0

        } else {

            return false

        }

    }


}

