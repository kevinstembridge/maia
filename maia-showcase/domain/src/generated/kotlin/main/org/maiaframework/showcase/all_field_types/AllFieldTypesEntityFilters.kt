// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.EntityFiltersRenderer

package org.maiaframework.showcase.all_field_types

import org.maiaframework.common.BlankStringException
import org.maiaframework.domain.DomainId
import org.maiaframework.jdbc.SqlParams
import org.maiaframework.jdbc.sql.conditions.AndOr
import org.maiaframework.jdbc.sql.conditions.SqlConditionOperator
import org.maiaframework.showcase.SimpleResponseDto
import org.maiaframework.showcase.enums.SomeEnum
import org.maiaframework.showcase.types.SomeBooleanType
import org.maiaframework.showcase.types.SomeIntType
import org.maiaframework.showcase.types.SomeLongType
import org.maiaframework.showcase.types.SomeProvidedBooleanType
import org.maiaframework.showcase.types.SomeProvidedIntType
import org.maiaframework.showcase.types.SomeProvidedLongType
import org.maiaframework.showcase.types.SomeProvidedStringType
import org.maiaframework.showcase.types.SomeStringType
import java.sql.Timestamp
import java.sql.Types
import java.time.Instant
import java.time.LocalDate
import java.time.Period
import java.util.concurrent.atomic.AtomicInteger


class AllFieldTypesEntityFilters {


    private val sqlParamCounter = AtomicInteger(1)


    fun and(vararg filters: AllFieldTypesEntityFilter): AllFieldTypesEntityFilter {

        return IterableFunctionFilter(filters.toList(), AndOr.and)

    }


    fun or(vararg filters: AllFieldTypesEntityFilter): AllFieldTypesEntityFilter {

        return IterableFunctionFilter(filters.toList(), AndOr.or)

    }


    fun nor(vararg filters: AllFieldTypesEntityFilter): AllFieldTypesEntityFilter {

        return IterableFunctionFilter(filters.toList(), AndOr.nor)

    }


    val createdByUsername: FieldFilter<String> 
        get() {

            return FieldFilter("created_by_name", Types.VARCHAR, this.sqlParamCounter) { value -> value }

        }


    val createdTimestampUtc: FieldFilter<Instant> 
        get() {

            return FieldFilter("created_timestamp_utc", Types.TIMESTAMP, this.sqlParamCounter) { value -> value?.let { Timestamp.from(it) } }

        }


    val id: FieldFilter<DomainId> 
        get() {

            return FieldFilter("id", Types.OTHER, this.sqlParamCounter) { value -> value?.value }

        }


    val lastModifiedByUsername: FieldFilter<String> 
        get() {

            return FieldFilter("last_modified_by_name", Types.VARCHAR, this.sqlParamCounter) { value -> value }

        }


    val lastModifiedTimestampUtc: FieldFilter<Instant> 
        get() {

            return FieldFilter("last_modified_timestamp_utc", Types.TIMESTAMP, this.sqlParamCounter) { value -> value?.let { Timestamp.from(it) } }

        }


    val someBoolean: FieldFilter<Boolean> 
        get() {

            return FieldFilter("some_boolean", Types.BIT, this.sqlParamCounter) { value -> value }

        }


    val someBooleanNullable: FieldFilter<Boolean?> 
        get() {

            return FieldFilter("some_boolean_nullable", Types.BIT, this.sqlParamCounter) { value -> value }

        }


    val someBooleanType: FieldFilter<SomeBooleanType> 
        get() {

            return FieldFilter("some_boolean_type", Types.BIT, this.sqlParamCounter) { value -> value?.value }

        }


    val someBooleanTypeNullable: FieldFilter<SomeBooleanType?> 
        get() {

            return FieldFilter("some_boolean_type_nullable", Types.BIT, this.sqlParamCounter) { value -> value?.value }

        }


    val someBooleanTypeProvided: FieldFilter<SomeProvidedBooleanType> 
        get() {

            return FieldFilter("some_boolean_type_provided", Types.BIT, this.sqlParamCounter) { value -> value?.value }

        }


    val someBooleanTypeProvidedNullable: FieldFilter<SomeProvidedBooleanType?> 
        get() {

            return FieldFilter("some_boolean_type_provided_nullable", Types.BIT, this.sqlParamCounter) { value -> value?.value }

        }


    val someDto: FieldFilter<SimpleResponseDto> 
        get() {

            return FieldFilter("some_dto", Types.OTHER, this.sqlParamCounter) { value -> value }

        }


    val someDtoNullable: FieldFilter<SimpleResponseDto?> 
        get() {

            return FieldFilter("some_dto_nullable", Types.OTHER, this.sqlParamCounter) { value -> value }

        }


    val someEnum: FieldFilter<SomeEnum> 
        get() {

            return FieldFilter("some_enum", Types.VARCHAR, this.sqlParamCounter) { value -> value?.name }

        }


    val someEnumNullable: FieldFilter<SomeEnum?> 
        get() {

            return FieldFilter("some_enum_nullable", Types.VARCHAR, this.sqlParamCounter) { value -> value?.name }

        }


    val someInstant: FieldFilter<Instant> 
        get() {

            return FieldFilter("some_instant", Types.TIMESTAMP, this.sqlParamCounter) { value -> value?.let { Timestamp.from(it) } }

        }


    val someInstantModifiable: FieldFilter<Instant> 
        get() {

            return FieldFilter("some_instant_modifiable", Types.TIMESTAMP, this.sqlParamCounter) { value -> value?.let { Timestamp.from(it) } }

        }


    val someInstantModifiableNullable: FieldFilter<Instant?> 
        get() {

            return FieldFilter("some_instant_modifiable_nullable", Types.TIMESTAMP, this.sqlParamCounter) { value -> value?.let { Timestamp.from(it) } }

        }


    val someInstantNullable: FieldFilter<Instant?> 
        get() {

            return FieldFilter("some_instant_nullable", Types.TIMESTAMP, this.sqlParamCounter) { value -> value?.let { Timestamp.from(it) } }

        }


    val someInt: FieldFilter<Int> 
        get() {

            return FieldFilter("some_int", Types.INTEGER, this.sqlParamCounter) { value -> value }

        }


    val someIntModifiable: FieldFilter<Int> 
        get() {

            return FieldFilter("some_int_modifiable", Types.INTEGER, this.sqlParamCounter) { value -> value }

        }


    val someIntNullable: FieldFilter<Int?> 
        get() {

            return FieldFilter("some_int_nullable", Types.INTEGER, this.sqlParamCounter) { value -> value }

        }


    val someIntType: FieldFilter<SomeIntType> 
        get() {

            return FieldFilter("some_int_type", Types.INTEGER, this.sqlParamCounter) { value -> value?.value }

        }


    val someIntTypeNullable: FieldFilter<SomeIntType?> 
        get() {

            return FieldFilter("some_int_type_nullable", Types.INTEGER, this.sqlParamCounter) { value -> value?.value }

        }


    val someIntTypeProvided: FieldFilter<SomeProvidedIntType> 
        get() {

            return FieldFilter("some_int_type_provided", Types.INTEGER, this.sqlParamCounter) { value -> value?.value }

        }


    val someIntTypeProvidedNullable: FieldFilter<SomeProvidedIntType?> 
        get() {

            return FieldFilter("some_int_type_provided_nullable", Types.INTEGER, this.sqlParamCounter) { value -> value?.value }

        }


    val someListOfEnums: ListFieldFilter<SomeEnum> 
        get() {

            return ListFieldFilter("some_list_of_enums")

        }


    val someListOfInstants: ListFieldFilter<Instant> 
        get() {

            return ListFieldFilter("some_list_of_instants")

        }


    val someListOfLocalDates: ListFieldFilter<LocalDate> 
        get() {

            return ListFieldFilter("some_list_of_local_dates")

        }


    val someListOfPeriods: ListFieldFilter<Period> 
        get() {

            return ListFieldFilter("some_list_of_periods")

        }


    val someListOfStringTypes: ListFieldFilter<SomeStringType> 
        get() {

            return ListFieldFilter("some_list_of_string_types")

        }


    val someListOfStrings: ListFieldFilter<String> 
        get() {

            return ListFieldFilter("some_list_of_strings")

        }


    val someLocalDateModifiable: FieldFilter<LocalDate> 
        get() {

            return FieldFilter("some_local_date_modifiable", Types.DATE, this.sqlParamCounter) { value -> value?.toString() }

        }


    val someLongType: FieldFilter<SomeLongType> 
        get() {

            return FieldFilter("some_long_type", Types.BIGINT, this.sqlParamCounter) { value -> value?.value }

        }


    val someLongTypeNullable: FieldFilter<SomeLongType?> 
        get() {

            return FieldFilter("some_long_type_nullable", Types.BIGINT, this.sqlParamCounter) { value -> value?.value }

        }


    val someLongTypeProvided: FieldFilter<SomeProvidedLongType> 
        get() {

            return FieldFilter("some_long_type_provided", Types.BIGINT, this.sqlParamCounter) { value -> value?.value }

        }


    val someLongTypeProvidedNullable: FieldFilter<SomeProvidedLongType?> 
        get() {

            return FieldFilter("some_long_type_provided_nullable", Types.BIGINT, this.sqlParamCounter) { value -> value?.value }

        }


    val somePeriodModifiable: FieldFilter<Period> 
        get() {

            return FieldFilter("some_period_modifiable", Types.VARCHAR, this.sqlParamCounter) { value -> value?.toString() }

        }


    val somePeriodNullable: FieldFilter<Period?> 
        get() {

            return FieldFilter("some_period_nullable", Types.VARCHAR, this.sqlParamCounter) { value -> value?.toString() }

        }


    val someProvidedStringType: FieldFilter<SomeProvidedStringType> 
        get() {

            return FieldFilter("some_provided_string_type", Types.VARCHAR, this.sqlParamCounter) { value -> value?.value }

        }


    val someProvidedStringTypeNullable: FieldFilter<SomeProvidedStringType?> 
        get() {

            return FieldFilter("some_provided_string_type_nullable", Types.VARCHAR, this.sqlParamCounter) { value -> value?.value }

        }


    val someString: FieldFilter<String> 
        get() {

            return FieldFilter("some_string", Types.VARCHAR, this.sqlParamCounter) { value -> value }

        }


    val someStringModifiable: FieldFilter<String> 
        get() {

            return FieldFilter("some_string_modifiable", Types.VARCHAR, this.sqlParamCounter) { value -> value }

        }


    val someStringNullable: FieldFilter<String?> 
        get() {

            return FieldFilter("some_string_nullable", Types.VARCHAR, this.sqlParamCounter) { value -> value }

        }


    val someStringType: FieldFilter<SomeStringType> 
        get() {

            return FieldFilter("some_string_type", Types.VARCHAR, this.sqlParamCounter) { value -> value?.value }

        }


    val someStringTypeNullable: FieldFilter<SomeStringType?> 
        get() {

            return FieldFilter("some_string_type_nullable", Types.VARCHAR, this.sqlParamCounter) { value -> value?.value }

        }


    class FieldFilter<T>(
        private val databaseColumnName: String,
        private val sqlType: Int,
        private val sqlParamCounter: AtomicInteger,
        private val valueMappingFunc: (T?) -> Any?,
    ) {


        infix fun eq(value: T): AllFieldTypesEntityFilter {

            return SimpleFunctionFilter(
                this.databaseColumnName,
                value,
                this.sqlType,
                this.sqlParamCounter,
                SqlConditionOperator.EQUAL,
                this.valueMappingFunc
            )

        }


        infix fun gt(value: T): AllFieldTypesEntityFilter {

            return SimpleFunctionFilter(
                this.databaseColumnName,
                value,
                this.sqlType,
                this.sqlParamCounter,
                SqlConditionOperator.GREATER_THAN,
                this.valueMappingFunc
            )

        }


        infix fun gte(value: T): AllFieldTypesEntityFilter {

            return SimpleFunctionFilter(
                this.databaseColumnName,
                value,
                this.sqlType,
                this.sqlParamCounter,
                SqlConditionOperator.GREATER_THAN_OR_EQUAL,
                this.valueMappingFunc
            )

        }


        infix fun lt(value: T): AllFieldTypesEntityFilter {

            return SimpleFunctionFilter(
                this.databaseColumnName,
                value,
                this.sqlType,
                this.sqlParamCounter,
                SqlConditionOperator.LESS_THAN,
                this.valueMappingFunc
            )

        }


        infix fun lte(value: T): AllFieldTypesEntityFilter {

            return SimpleFunctionFilter(
                this.databaseColumnName,
                value,
                this.sqlType,
                this.sqlParamCounter,
                SqlConditionOperator.LESS_THAN_OR_EQUAL,
                this.valueMappingFunc
            )

        }


        infix fun ne(value: T): AllFieldTypesEntityFilter {

            return SimpleFunctionFilter(
                this.databaseColumnName,
                value,
                this.sqlType,
                this.sqlParamCounter,
                SqlConditionOperator.NOT_EQUAL,
                this.valueMappingFunc
            )

        }


        infix fun `in`(value: Iterable<T>): AllFieldTypesEntityFilter {

            return MultiValueFunctionFilter(this.databaseColumnName, this.sqlType, this.sqlParamCounter, value, this.valueMappingFunc)

        }


        fun isNotNull(): AllFieldTypesEntityFilter {

            return IsNotNullFilter(this.databaseColumnName)

        }


        fun isNull(): AllFieldTypesEntityFilter {

            return IsNullFilter(this.databaseColumnName)

        }


        infix fun contains(value: T): AllFieldTypesEntityFilter {

            TODO("Not implemented yet")

        }


    }


    class ListFieldFilter<T>(private val databaseColumnName: String) { 


        infix fun contains(value: T): AllFieldTypesEntityFilter {

            return ListFieldContainsFilter(this.databaseColumnName, value)

        }


    }


    class NoopFilter : AllFieldTypesEntityFilter {


        override fun whereClause(fieldConverter: AllFieldTypesEntityFieldConverter): String {
            return "1 = 1"
        }


        override fun populateSqlParams(sqlParams: SqlParams) {
            // Do nothing
        }


    }


    private class SimpleFunctionFilter<VALUE>(
        private val fieldName: String,
        private val value: VALUE,
        private val sqlType: Int,
        sqlParamCounter: AtomicInteger,
        private val sqlConditionOperator: SqlConditionOperator,
        private val valueMappingFunc: (VALUE?) -> Any?
    ) : AllFieldTypesEntityFilter {


        private val sqlParamName = "${fieldName}_${sqlParamCounter.getAndIncrement()}"


        init {

            BlankStringException.throwIfBlank(fieldName, "fieldName")

        }


        override fun whereClause(fieldConverter: AllFieldTypesEntityFieldConverter): String {

            return "$fieldName ${operatorFor(sqlConditionOperator)} :${this.sqlParamName}"

        }


        private fun operatorFor(sqlConditionOperator: SqlConditionOperator): String {

            return when (sqlConditionOperator) {
                SqlConditionOperator.EQUAL -> "="
                SqlConditionOperator.NOT_EQUAL -> "!="
                SqlConditionOperator.GREATER_THAN -> ">"
                SqlConditionOperator.GREATER_THAN_OR_EQUAL -> ">="
                SqlConditionOperator.LESS_THAN -> "<"
                SqlConditionOperator.LESS_THAN_OR_EQUAL -> "<="
                SqlConditionOperator.LIKE -> "like"
            }

        }


        override fun populateSqlParams(sqlParams: SqlParams) {

            val transformedValue = this.valueMappingFunc.invoke(this.value)
            sqlParams.addValue(this.sqlParamName, transformedValue, this.sqlType)

        }


    }


    private class MultiValueFunctionFilter<VALUE>(
        private val fieldName: String,
        private val sqlType: Int,
        sqlParamCounter: AtomicInteger,
        private val values: Iterable<VALUE>,
        private val valueMappingFunc: (VALUE?) -> Any?
    ) : AllFieldTypesEntityFilter {


        private val sqlParamName = "${fieldName}_${sqlParamCounter.getAndIncrement()}"


        init {

            BlankStringException.throwIfBlank(fieldName, "fieldName")
            require(values.toList().isNotEmpty()) { "The provided list of values must not be empty." }

        }


        override fun whereClause(fieldConverter: AllFieldTypesEntityFieldConverter): String {

            return "$fieldName in (:$sqlParamName)"

        }


        override fun populateSqlParams(sqlParams: SqlParams) {

            val mappedValues = this.values.map(valueMappingFunc)
            sqlParams.addValue(this.sqlParamName, mappedValues, this.sqlType)

        }


    }


    private class IterableFunctionFilter(
        private val filters: List<AllFieldTypesEntityFilter>,
        private val andOr: AndOr
    ) : AllFieldTypesEntityFilter {


        override fun whereClause(fieldConverter: AllFieldTypesEntityFieldConverter): String {

            return this.filters.map { it.whereClause(fieldConverter) }.joinToString(" ${andOr.name} ")

        }


        override fun populateSqlParams(sqlParams: SqlParams) {

            this.filters.forEach { it.populateSqlParams(sqlParams) }

        }


    }


    private class JsonListFieldContainsFilter<VALUE>(
        private val databaseColumnName: String,
        private val value: VALUE
    ): AllFieldTypesEntityFilter {


        override fun whereClause(fieldConverter: AllFieldTypesEntityFieldConverter): String {

            return "jsonb_path_exists($databaseColumnName, '$ ? (@ == \"$value\")')"

        }


        override fun populateSqlParams(sqlParams: SqlParams) {

            // do nothing

        }


    }


    private class ListFieldContainsFilter<VALUE>(
        private val databaseColumnName: String,
        private val value: VALUE
    ): AllFieldTypesEntityFilter {


        override fun whereClause(fieldConverter: AllFieldTypesEntityFieldConverter): String {

            return "'$value' = ANY($databaseColumnName)"

        }


        override fun populateSqlParams(sqlParams: SqlParams) {

            // do nothing

        }


    }


    private class IsNullFilter(
        private val databaseColumnName: String
    ) : AllFieldTypesEntityFilter {


        override fun whereClause(fieldConverter: AllFieldTypesEntityFieldConverter): String {

            return "$databaseColumnName is null"

        }


        override fun populateSqlParams(sqlParams: SqlParams) {

            // do nothing

        }


    }


    private class IsNotNullFilter(
        private val databaseColumnName: String
    ) : AllFieldTypesEntityFilter {


        override fun whereClause(fieldConverter: AllFieldTypesEntityFieldConverter): String {

            return "$databaseColumnName is not null"

        }


        override fun populateSqlParams(sqlParams: SqlParams) {

            // do nothing

        }


    }


}

