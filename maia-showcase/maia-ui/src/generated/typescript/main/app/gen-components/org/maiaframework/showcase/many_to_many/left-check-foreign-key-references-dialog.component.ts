// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.ui.CheckForeignKeyReferencesDialogComponentRenderer
import { Component, Inject, OnInit } from '@angular/core';
import { MatDialog, MatDialogRef, MAT_DIALOG_DATA, MatDialogTitle, MatDialogContent, MatDialogActions } from '@angular/material/dialog';
import { of } from 'rxjs';
import { catchError, tap } from 'rxjs/operators';
import { ForeignKeyReferenceService } from '@app/gen-components/common/services/foreign-key-reference.service';
import { MessageDetails } from '@app/components/message-panel/message-details';
import { MatButtonModule } from '@angular/material/button';
import { MessagePanelComponent } from '@app/components/message-panel/message-panel.component';
import { MatProgressSpinnerModule } from '@angular/material/progress-spinner';


@Component({
    imports: [MatDialogTitle, MatDialogContent, MatProgressSpinnerModule, MessagePanelComponent, MatDialogActions, MatButtonModule],
    selector: 'app-left-check-foreign-key-references-dialog',
    templateUrl: './left-check-foreign-key-references-dialog.component.html'
})
export class LeftCheckForeignKeyReferencesDialogComponent implements OnInit {

    checking: boolean;
    messageDetails = new MessageDetails();

    constructor(
        public dialogRef: MatDialogRef<LeftCheckForeignKeyReferencesDialogComponent>,
        @Inject(MAT_DIALOG_DATA) private dto: any,
        private foreignKeyReferenceService: ForeignKeyReferenceService
    ) {}


    ngOnInit() {

        this.foreignKeyReferenceService.checkLeftForReferences(this.dto.id)
          .pipe(
            tap(() => this.checking = true),
            catchError(err => {
              this.messageDetails.setErrorDetailsFromHttpError(err);
              return of(null);
            }),
            tap(() => this.checking = false)
          ).subscribe(
            res => {
              if (res.exists) {
                this.messageDetails.setErrorMessage('Foreign key references to entity ' + res.entityKey + ' exist.');
              } else {
                this.dialogRef.close(true);
              }
            }
          );

    }


    onCancel() {
        this.dialogRef.close();
    }


}
