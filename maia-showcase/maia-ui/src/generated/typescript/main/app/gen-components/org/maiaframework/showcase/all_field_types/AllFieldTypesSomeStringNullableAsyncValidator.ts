// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.ui.AsyncValidatorRenderer

import { AbstractControl, AsyncValidator, ValidationErrors, FormControl, FormGroup } from '@angular/forms';
import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
import {AllFieldTypesCrudService} from '@app/gen-components/org/maiaframework/showcase/all_field_types/all-field-types-crud.service';
import {AllFieldTypesSomeStringNullableRequestDto} from '@app/gen-components/org/maiaframework/showcase/all_field_types/AllFieldTypesSomeStringNullableRequestDto';


@Injectable({
    providedIn: 'root'
})
export class AllFieldTypesSomeStringNullableAsyncValidator implements AsyncValidator {


    constructor(
        private apiService: AllFieldTypesCrudService
    ) { }


    validate(ctrl: FormControl): Promise<ValidationErrors | null> | Observable<ValidationErrors | null> {

        if (ctrl.value === false || ctrl.dirty === false) {
            return of(null);
        }

        const requestBody = {
            someStringNullable: ctrl.value
        } as AllFieldTypesSomeStringNullableRequestDto;

        return this.apiService.existsBySomeStringNullable(requestBody).pipe(
            map(response => (response.invalid ? { message: response.message, notUnique: true } : null)),
            catchError(() => of(null))
        );

    }


}
