// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.ui.AsyncValidatorRenderer

import { AbstractControl, AsyncValidator, ValidationErrors, FormControl, FormGroup } from '@angular/forms';
import { Injectable } from '@angular/core';
import { Observable, of } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
import {SimpleCrudService} from '@app/gen-components/org/maiaframework/showcase/simple/simple-crud.service';
import {SimpleSomeStringRequestDto} from '@app/gen-components/org/maiaframework/showcase/simple/SimpleSomeStringRequestDto';


@Injectable({
    providedIn: 'root'
})
export class SimpleSomeStringAsyncValidator implements AsyncValidator {


    constructor(
        private apiService: SimpleCrudService
    ) { }


    validate(ctrl: AbstractControl): Observable<ValidationErrors | null> {

        if (ctrl.value === false || ctrl.dirty === false) {
            return of(null);
        }

        const requestBody = {
            someString: ctrl.value
        } as SimpleSomeStringRequestDto;

        return this.apiService.existsBySomeString(requestBody).pipe(
            map(response => (response.invalid ? { message: response.message, notUnique: true } : null)),
            catchError(() => of(null))
        );

    }


}
