// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.ui.EntityFormComponentRenderer

import {Component, OnInit, signal} from '@angular/core';
import {FormsModule, ReactiveFormsModule} from '@angular/forms';
import {FormField, form, maxLength, required, submit, validateHttp} from '@angular/forms/signals';
import {MatAutocompleteModule} from '@angular/material/autocomplete';
import {MatButtonModule} from '@angular/material/button';
import {MatOptionModule} from '@angular/material/core';
import {MatDialog, MatDialogActions, MatDialogContent, MatDialogRef, MatDialogTitle} from '@angular/material/dialog';
import {MatFormFieldModule} from '@angular/material/form-field';
import {MatInputModule} from '@angular/material/input';
import {MatOption, MatSelect} from '@angular/material/select';
import {MatTooltip} from '@angular/material/tooltip';
import {ProblemDetail} from '@app/gen-components/common/model/ProblemDetail';
import {AllFieldTypesCreateRequestDto} from '@app/gen-components/org/maiaframework/showcase/all_field_types/AllFieldTypesCreateRequestDto';
import {AllFieldTypesCrudService} from '@app/gen-components/org/maiaframework/showcase/all_field_types/all-field-types-crud.service';
import {SomeEnum} from '@app/gen-components/org/maiaframework/showcase/enums/SomeEnum';
import {SomeEnumSelectOptions} from '@app/gen-components/org/maiaframework/showcase/enums/SomeEnumSelectOptions';
import {Observable, Subject, of} from 'rxjs';
import {catchError, debounceTime, distinctUntilChanged, filter, map, switchMap, tap} from 'rxjs/operators';



@Component({
    imports: [
        FormField,
        FormsModule,
        MatAutocompleteModule,
        MatButtonModule,
        MatDialogActions,
        MatDialogContent,
        MatDialogTitle,
        MatFormFieldModule,
        MatInputModule,
        MatOption,
        MatOptionModule,
        MatSelect,
        MatTooltip,
        ReactiveFormsModule,
    ],
    selector: 'app-all-field-types-create-dialog',
    styleUrls: ['./all-field-types-create-dialog.component.scss'],
    templateUrl: './all-field-types-create-dialog.component.html'
})
export class AllFieldTypesCreateDialogComponent implements OnInit {


    dialogFormModel = signal<AllFieldTypesCreateRequestDto>({
        someBoolean: false,
        someBooleanNullable: false,
        someBooleanType: false,
        someBooleanTypeNullable: false,
        someBooleanTypeProvided: false,
        someBooleanTypeProvidedNullable: false,
        someDto: {
            someBoolean: false,
            someInt: 0,
            someString: ''
        },
        someDtoNullable: {
            someBoolean: false,
            someInt: 0,
            someString: ''
        },
        someEnum: SomeEnum.OK,
        someEnumNullable: SomeEnum.OK,
        someInstant: '',
        someInstantModifiable: '',
        someInstantModifiableNullable: '',
        someInstantNullable: '',
        someInt: 0,
        someIntModifiable: 0,
        someIntNullable: 0,
        someIntType: 0,
        someIntTypeNullable: 0,
        someIntTypeProvided: 0,
        someIntTypeProvidedNullable: 0,
        someListOfEnums: [],
        someListOfInstants: [],
        someListOfLocalDates: [],
        someListOfPeriods: [],
        someListOfStringTypes: [],
        someListOfStrings: [],
        someLocalDateModifiable: '',
        someLongType: 0,
        someLongTypeNullable: 0,
        someLongTypeProvided: 0,
        someLongTypeProvidedNullable: 0,
        someMapOfStringToInteger: {},
        someMapOfStringTypeToStringType: {},
        somePeriodModifiable: '',
        somePeriodNullable: '',
        someProvidedStringType: '',
        someProvidedStringTypeNullable: '',
        someString: '',
        someStringModifiable: '',
        someStringNullable: '',
        someStringType: '',
        someStringTypeNullable: '',
    });


    dialogForm = form(this.dialogFormModel, (schemaPath) => {
        required(schemaPath.someBoolean, { message: 'null is required' })
        required(schemaPath.someBooleanType, { message: 'null is required' })
        required(schemaPath.someBooleanTypeProvided, { message: 'null is required' })
        required(schemaPath.someInstant, { message: 'null is required' })
        required(schemaPath.someInstantModifiable, { message: 'null is required' })
        required(schemaPath.someInt, { message: 'null is required' })
        required(schemaPath.someIntModifiable, { message: 'null is required' })
        required(schemaPath.someIntType, { message: 'Some Int Type is required' })
        validateHttp(schemaPath.someIntType, {
            request: ({value}) => {
                return {
                    url: 'someIntType.huh',
                    body: value(),
                }
            },
            onSuccess: (response: any) => {
                if (response.huh) {
                    return {
                        kind: 'huh',
                        message: 'huh'
                    };
                }
                return null;
            },
            onError: (error) => ({
                kind: 'huh',
                message: 'huh'
            }),
        });
        required(schemaPath.someIntTypeProvided, { message: 'null is required' })
        required(schemaPath.someLongType, { message: 'Some Long Type is required' })
        validateHttp(schemaPath.someLongType, {
            request: ({value}) => {
                return {
                    url: 'someLongType.huh',
                    body: value(),
                }
            },
            onSuccess: (response: any) => {
                if (response.huh) {
                    return {
                        kind: 'huh',
                        message: 'huh'
                    };
                }
                return null;
            },
            onError: (error) => ({
                kind: 'huh',
                message: 'huh'
            }),
        });
        required(schemaPath.someLongTypeProvided, { message: 'null is required' })
        required(schemaPath.someLocalDateModifiable, { message: 'null is required' })
        required(schemaPath.somePeriodModifiable, { message: 'null is required' })
        maxLength(schemaPath.somePeriodModifiable, 100)
        maxLength(schemaPath.somePeriodNullable, 100)
        required(schemaPath.someEnum, { message: 'null is required' })
        maxLength(schemaPath.someEnum, 100)
        maxLength(schemaPath.someEnumNullable, 100)
        required(schemaPath.someString, { message: 'Some String is required' })
        maxLength(schemaPath.someString, 100)
        validateHttp(schemaPath.someString, {
            request: ({value}) => {
                return {
                    url: 'someString.huh',
                    body: value(),
                }
            },
            onSuccess: (response: any) => {
                if (response.huh) {
                    return {
                        kind: 'huh',
                        message: 'huh'
                    };
                }
                return null;
            },
            onError: (error) => ({
                kind: 'huh',
                message: 'huh'
            }),
        });
        required(schemaPath.someStringModifiable, { message: 'null is required' })
        maxLength(schemaPath.someStringModifiable, 100)
        maxLength(schemaPath.someStringNullable, 100)
        validateHttp(schemaPath.someStringNullable, {
            request: ({value}) => {
                return {
                    url: 'someStringNullable.huh',
                    body: value(),
                }
            },
            onSuccess: (response: any) => {
                if (response.huh) {
                    return {
                        kind: 'huh',
                        message: 'huh'
                    };
                }
                return null;
            },
            onError: (error) => ({
                kind: 'huh',
                message: 'huh'
            }),
        });
        required(schemaPath.someStringType, { message: 'Some String Type is required' })
        maxLength(schemaPath.someStringType, 100)
        validateHttp(schemaPath.someStringType, {
            request: ({value}) => {
                return {
                    url: 'someStringType.huh',
                    body: value(),
                }
            },
            onSuccess: (response: any) => {
                if (response.huh) {
                    return {
                        kind: 'huh',
                        message: 'huh'
                    };
                }
                return null;
            },
            onError: (error) => ({
                kind: 'huh',
                message: 'huh'
            }),
        });
        maxLength(schemaPath.someStringTypeNullable, 100)
        required(schemaPath.someProvidedStringType, { message: 'null is required' })
        maxLength(schemaPath.someProvidedStringType, 100)
        maxLength(schemaPath.someProvidedStringTypeNullable, 100)
        required(schemaPath.someListOfEnums, { message: 'null is required' })
        required(schemaPath.someListOfInstants, { message: 'null is required' })
        required(schemaPath.someListOfLocalDates, { message: 'null is required' })
        required(schemaPath.someListOfPeriods, { message: 'null is required' })
        required(schemaPath.someListOfStrings, { message: 'null is required' })
        required(schemaPath.someListOfStringTypes, { message: 'null is required' })
        required(schemaPath.someMapOfStringToInteger, { message: 'null is required' })
        required(schemaPath.someMapOfStringTypeToStringType, { message: 'null is required' })
        required(schemaPath.someDto, { message: 'null is required' })
    });


    problemDetail = signal<ProblemDetail | null>(null);


    protected readonly SomeEnumSelectOptions = SomeEnumSelectOptions;


    constructor(
        public dialogRef: MatDialogRef<AllFieldTypesCreateDialogComponent>,
        private formService: AllFieldTypesCrudService,
    ) {}


    ngOnInit() {

    }


    async onSubmit(e: Event) {

        e.preventDefault();

        this.problemDetail.set(null);

        await submit(this.dialogForm, async (form) => {

            this.formService.create(form().value())
                .subscribe({
                    next: () => {
                        this.dialogRef.close(true);
                    },
                    error: err => {
                        this.problemDetail.set(err.error);
                    }
                });

        });

    }


    onCancel(): void {
        this.dialogRef.close();
    }


}

