// This source was generated by the Maia Framework code generator
// Renderer class: class org.maiaframework.gen.renderers.ui.DtoHtmlAgGridTableComponentRenderer
import { DecimalPipe } from '@angular/common';
import { Component, EventEmitter, Output } from '@angular/core';
import { AuthService } from '@app/auth/auth.service';

import {SimpleTableService} from '@app/gen-components/org/maiaframework/showcase/simple/simple-table.service';
import { SimpleTableDto } from './SimpleTableDto';
import { MatIconModule } from '@angular/material/icon';
import { MatButtonModule } from '@angular/material/button';
import { FormsModule } from '@angular/forms';
import { AgGridAngular } from 'ag-grid-angular';
import { agGridTheme } from '@app/themes/ag-grid-theme';
import { ColDef, FilterModel, GridApi, GridReadyEvent, ICellRendererParams, RowModelType } from 'ag-grid-community';
import {SimpleTableAgGridDatasource} from '@app/gen-components/org/maiaframework/showcase/simple/SimpleTableAgGridDatasource';


@Component({
    imports: [AgGridAngular, FormsModule, MatButtonModule, MatIconModule],
    providers: [SimpleTableService, DecimalPipe],
    selector: 'app-simple-table',
    templateUrl: './simple-table.component.html'
})
export class SimpleTableComponent {


    @Output() addButtonClicked = new EventEmitter<void>();


    public columnDefs: ColDef[] = [
        { field: 'someString', cellDataType: 'text', filter: true },
        { field: 'id', cellDataType: 'text', filter: true },
        { field: 'createdTimestampUtc', cellDataType: 'text', filter: true },
    ];

    public defaultColDef: ColDef = {
        filter: true,
        flex: 1,
        floatingFilter: true,
        minWidth: 100,
        sortable: true
    };


    public rowBuffer = 0;


    public rowSelection = {
         mode: 'multiRow',
    };
    
    
    public agGridTheme = agGridTheme;


    public rowModelType: RowModelType = 'infinite';


    public cacheBlockSize = 100;


    public cacheOverflowSize = 2;


    public maxConcurrentDatasourceRequests = 1;


    public infiniteInitialRowCount = 1000;


    public maxBlocksInCache = 10;


    public rowData!: SimpleTableDto[];


    private gridApi!: GridApi<SimpleTableDto>;


    constructor(
        private datasource: SimpleTableAgGridDatasource,
        private authService: AuthService
    ) {}


    onGridReady(params: GridReadyEvent<SimpleTableDto>) {

        this.gridApi = params.api;
        params.api?.setGridOption('datasource', this.datasource);

    }

    get addButtonVisible(): boolean {

        return this.authService.currentUserHasThisAuthority(Authority.ROLE_ADMIN);

    }


    onAddButtonClicked() {

        this.addButtonClicked.emit();

    }


    reapplyFilters() {

        this.gridApi.onFilterChanged();

    }


    getFilterModel(): FilterModel {

        return this.gridApi.getFilterModel();

    }


}
